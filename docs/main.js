!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);i(1),i(5),i(6),i(7),i(8)},function(t,e,i){var r=i(2);"string"==typeof r&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1};i(4)(r,n);r.locals&&(t.exports=r.locals)},function(t,e,i){(t.exports=i(3)(!1)).push([t.i,"#cr-stage {\r\n  margin: 0 auto;\r\n  padding: 2%;\r\n}\r\n",""])},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var n=(a=r,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(h," */")),s=r.sources.map(function(t){return"/*# sourceURL=".concat(r.sourceRoot).concat(t," */")});return[i].concat(s).concat([n]).join("\n")}var a,o,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(i,"}"):i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},n=0;n<this.length;n++){var s=this[n][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var o=t[a];null!=o[0]&&r[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="(".concat(o[2],") and (").concat(i,")")),e.push(o))}},e}},function(t,e,i){"use strict";var r,n={},s=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},a=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}();function o(t,e){for(var i=[],r={},n=0;n<t.length;n++){var s=t[n],a=e.base?s[0]+e.base:s[0],o={css:s[1],media:s[2],sourceMap:s[3]};r[a]?r[a].parts.push(o):i.push(r[a]={id:a,parts:[o]})}return i}function h(t,e){for(var i=0;i<t.length;i++){var r=t[i],s=n[r.id],a=0;if(s){for(s.refs++;a<s.parts.length;a++)s.parts[a](r.parts[a]);for(;a<r.parts.length;a++)s.parts.push(p(r.parts[a],e))}else{for(var o=[];a<r.parts.length;a++)o.push(p(r.parts[a],e));n[r.id]={id:r.id,refs:1,parts:o}}}}function u(t){var e=document.createElement("style");if(void 0===t.attributes.nonce){var r=i.nc;r&&(t.attributes.nonce=r)}if(Object.keys(t.attributes).forEach(function(i){e.setAttribute(i,t.attributes[i])}),"function"==typeof t.insert)t.insert(e);else{var n=a(t.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(e)}return e}var f,c=(f=[],function(t,e){return f[t]=e,f.filter(Boolean).join("\n")});function l(t,e,i,r){var n=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=c(e,n);else{var s=document.createTextNode(n),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(s,a[e]):t.appendChild(s)}}var d=null,y=0;function p(t,e){var i,r,n;if(e.singleton){var s=y++;i=d||(d=u(e)),r=l.bind(null,i,s,!1),n=l.bind(null,i,s,!0)}else i=u(e),r=function(t,e,i){var r=i.css,n=i.media,s=i.sourceMap;if(n&&t.setAttribute("media",n),s&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}.bind(null,i,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s());var i=o(t,e);return h(i,e),function(t){for(var r=[],s=0;s<i.length;s++){var a=i[s],u=n[a.id];u&&(u.refs--,r.push(u))}t&&h(o(t,e),e);for(var f=0;f<r.length;f++){var c=r[f];if(0===c.refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete n[c.id]}}}}},function(t,e){"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
* Crafty v0.5.4
* http://craftyjs.com
*
* Copyright 2010-2013, Louis Stowasser
* Dual licensed under the MIT or GPL licenses.
*/!function(t,e,i){var r,n,s,a,o,h,u,f,c,l,d,y,p,_,m,g,v,C=function(t){return new C.fn.init(t)},x=function(){r=1,s=1,a={},o={},h={},[],l=0,d=1e3/(n=50),y=(new Date).getTime(),p=Array.prototype.slice,_=/\s*,\s*/,m=/\s+/};function w(){var t=r++;return t in o?w():t}x(),C.fn=C.prototype={init:function(t){if("string"!=typeof t)return t||(t=0)in o||(o[t]=this),t in o?(this[0]=t,this.length=1,this.__c||(this.__c={}),o[t]||(o[t]=this),o[t]):(this.length=0,this);var e,i,r,n,s,h,u,f=0,c=!1,l=!1;if("*"===t){for(e in h=0,o)this[h]=+e,h++;return this.length=h,1===h?o[this[0]]:this}for(e in-1!==t.indexOf(",")?(l=!0,r=_):-1!==t.indexOf(" ")&&(c=!0,r=m),o)if(o.hasOwnProperty(e))if(i=o[e],c||l){for(h=0,u=(n=t.split(r)).length,s=0;h<u;h++)i.__c[n[h]]&&s++;(c&&s===u||l&&s>0)&&(this[f++]=+e)}else i.__c[t]&&(this[f++]=+e);if(f>0&&!c&&!l&&this.extend(a[t]),n&&c)for(h=0;h<u;h++)this.extend(a[n[h]]);return this.length=f,1===f?o[this[f-1]]:this},setName:function(t){var e=String(t);return this._entityName=e,this.trigger("NewEntityName",e),this},addComponent:function(t){var e,i,r,n,s=[],o=0,h=0;if(arguments.length>1)for(i=arguments.length;h<i;h++)s.push(arguments[h]);else if(-1!==t.indexOf(","))for(i=(r=t.split(_)).length;h<i;h++)s.push(r[h]);else s.push(t);for(e=s.length;o<e;o++)1!=this.__c[s[o]]&&(this.__c[s[o]]=!0,n=a[s[o]],this.extend(n),n&&"init"in n&&n.init.call(this));return this.trigger("NewComponent",s),this},toggleComponent:function(t){var e,i,r=0;if(arguments.length>1)for(e=arguments.length;r<e;r++)this.has(arguments[r])?this.removeComponent(arguments[r]):this.addComponent(arguments[r]);else if(-1!==t.indexOf(","))for(e=(i=t.split(_)).length;r<e;r++)this.has(i[r])?this.removeComponent(i[r]):this.addComponent(i[r]);else this.has(t)?this.removeComponent(t):this.addComponent(t);return this},requires:function(t){for(var e,i=t.split(_),r=0,n=i.length;r<n;++r)e=i[r],this.has(e)||this.addComponent(e);return this},removeComponent:function(t,e){if(!1===e){var i,r=a[t];for(i in r)delete this[i]}return delete this.__c[t],this.trigger("RemoveComponent",t),this},has:function(t){return!!this.__c[t]},attr:function(t,e){if(1===arguments.length)return"string"==typeof t?this[t]:(this.extend(t),this.trigger("Change",t),this);this[t]=e;var i={};return i[t]=e,this.trigger("Change",i),this},toArray:function(){return p.call(this,0)},timeout:function(t,e){return this.each(function(){var i=this;setTimeout(function(){t.call(i)},e)}),this},bind:function(t,e){if(1===this.length){h[t]||(h[t]={});var i=h[t];return i[this[0]]||(i[this[0]]=[]),i[this[0]].push(e),this}return this.each(function(){h[t]||(h[t]={});var i=h[t];i[this[0]]||(i[this[0]]=[]),i[this[0]].push(e)}),this},unbind:function(t,e){return this.each(function(){var i,r,n=h[t],s=0;if(!n||!n[this[0]])return this;if(i=n[this[0]].length,!e)return delete n[this[0]],this;for(;s<i;s++)(r=n[this[0]])[s]==e&&(r.splice(s,1),s--)}),this},trigger:function(t,e){if(1===this.length){if(h[t]&&h[t][this[0]])for(var i=h[t][this[0]],r=0,n=i.length;r<n;r++)i[r].call(this,e);return this}return this.each(function(){if(h[t]&&h[t][this[0]])for(var i=h[t][this[0]],r=0,n=i.length;r<n;r++)i[r].call(this,e)}),this},each:function(t){for(var e=0,i=this.length;e<i;e++)o[this[e]]&&t.call(o[this[e]],e);return this},clone:function(){var t,e,i=this.__c,r=C.e();for(t in i)r.addComponent(t);for(e in this)"0"!=e&&"_global"!=e&&"_changed"!=e&&"function"!=typeof this[e]&&"object"!=typeof this[e]&&(r[e]=this[e]);return r},setter:function(t,e){return C.support.setter?this.__defineSetter__(t,e):C.support.defineProperty?Object.defineProperty(this,t,{set:e,configurable:!0}):c.push({prop:t,obj:this,fn:e}),this},destroy:function(){this.each(function(){for(var t in this.trigger("Remove"),h)this.unbind(t);delete o[this[0]]})}},C.fn.init.prototype=C.fn,C.extend=C.fn.extend=function(t){var e;if(!t)return this;for(e in t)this!==t[e]&&(this[e]=t[e]);return this},C.extend({init:function(t,e,i){return C.viewport.init(t,e,i),this.trigger("Load"),this.timer.init(),this},getVersion:function(){return"0.5.4"},stop:function(i){if(this.timer.stop(),i){if(C.audio.remove(),C.stage&&C.stage.elem.parentNode){var r=document.createElement("div");r.id=C.stage.elem.id,C.stage.elem.parentNode.replaceChild(r,C.stage.elem)}x(),e(C,t,t.document)}return C.trigger("CraftyStop"),this},pause:function(t){return(1==arguments.length?t:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){C.timer.stop()},0),C.keydown={}):(this.trigger("Unpause"),this._paused=!1,setTimeout(function(){C.timer.init()},0)),this},isPaused:function(){return this._paused},timer:{prev:+new Date,current:+new Date,currentTime:+new Date,frames:0,frameTime:0,init:function(){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||null;e?(u=function(){C.timer.step(),f=e(u)})():u=setInterval(function(){C.timer.step()},1e3/n)},stop:function(){C.trigger("CraftyStopTimer"),"number"==typeof u&&clearInterval(u);var e=t.cancelRequestAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||null;e&&e(f),u=null},step:function(){for(l=0,this.currentTime=+new Date,this.currentTime-y>60*d&&(y=this.currentTime-d);this.currentTime>y;)C.trigger("EnterFrame",{frame:s++}),y+=d,l++;l&&C.DrawManager.draw(),this.currentTime>this.frameTime?(C.trigger("MessureFPS",{value:this.frame}),this.frame=0,this.frameTime=this.currentTime+1e3):this.frame++},getFPS:function(){return n},simulateFrames:function(t){for(;t-- >0;)C.trigger("EnterFrame",{frame:s++});C.DrawManager.draw()}},e:function(){var t,e=w();return o[e]=null,o[e]=t=C(e),arguments.length>0&&t.addComponent.apply(t,arguments),t.setName("Entity #"+e),t.addComponent("obj"),C.trigger("NewEntity",{id:e}),t},c:function(t,e){a[t]=e},trigger:function(t,e){var i,r,n,s=h[t];for(i in s)if(s.hasOwnProperty(i))for(r=0,n=s[i].length;r<n;r++)s[i]&&s[i][r]&&(o[i]?s[i][r].call(C(+i),e):s[i][r].call(C,e))},bind:function(t,e){h[t]||(h[t]={});var i=h[t];return i.global||(i.global=[]),i.global.push(e)-1},unbind:function(t,e){var i,r,n,s,a=h[t];if(void 0===a||void 0===a.global||0===a.global.length)return!1;if(1===arguments.length)return delete a.global,!0;for(s=!1,i=0,r=(n=a.global).length;i<r;i++)n[i]===e&&(s=!0,n.splice(i,1),i--);return s},frame:function(){return s},components:function(){return a},isComp:function(t){return t in a},debug:function(){return o},settings:(g={},v={},{register:function(t,e){v[t]=e},modify:function(t,e){v[t]&&(v[t].call(g[t],e),g[t]=e)},get:function(t){return g[t]}}),clone:function t(e){if(null===e||"object"!=typeof e)return e;var i=e.constructor();for(var r in e)i[r]=t(e[r]);return i}}),C.bind("Load",function(){!C.support.setter&&C.support.defineProperty&&(c=[],C.bind("EnterFrame",function(){for(var t,e=0,i=c.length;e<i;++e)(t=c[e]).obj[t.prop]!==t.obj["_"+t.prop]&&t.fn.call(t.obj,t.obj[t.prop])}))}),e(C,t,t.document),t.Crafty=C,void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return C}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__=[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(window,function(Crafty,window,document){!function(t){var e,i=function(t){e=t||64,this.map={}},r={};function n(t,e,i){this.keys=t,this.map=i,this.obj=e}i.prototype={insert:function(t){var e,r,s=i.key(t),a=new n(s,t,this),o=0;for(o=s.x1;o<=s.x2;o++)for(e=s.y1;e<=s.y2;e++)r=o<<16^e,this.map[r]||(this.map[r]=[]),this.map[r].push(t);return a},search:function(t,e){var n,s,a,o=i.key(t,r),h=[];for(void 0===e&&(e=!0),n=o.x1;n<=o.x2;n++)for(s=o.y1;s<=o.y2;s++)if(cell=this.map[n<<16^s],cell)for(a=0;a<cell.length;a++)h.push(cell[a]);if(e){var u,f,c=[],d={};for(n=0,l=h.length;n<l;n++)(u=h[n])&&!d[f=u[0]]&&u.x<t._x+t._w&&u._x+u._w>t._x&&u.y<t._y+t._h&&u._h+u._y>t._y&&(d[f]=h[n]);for(u in d)c.push(d[u]);return c}return h},remove:function(t,e){var n,s,a=0;for(1==arguments.length&&(t=i.key(e=t,r)),a=t.x1;a<=t.x2;a++)for(n=t.y1;n<=t.y2;n++)if(s=a<<16^n,this.map[s]){var o,h=this.map[s],u=h.length;for(o=0;o<u;o++)h[o]&&h[o][0]===e[0]&&h.splice(o,1)}},refresh:function(t){var e,r,n,s,a,o=t.keys,h=t.obj;for(r=o.x1;r<=o.x2;r++)for(n=o.y1;n<=o.y2;n++)if(e=this.map[r<<16^n])for(a=e.length,s=0;s<a;s++)e[s]&&e[s][0]===h[0]&&e.splice(s,1);for(i.key(h,o),r=o.x1;r<=o.x2;r++)for(n=o.y1;n<=o.y2;n++)(e=this.map[r<<16^n])||(e=this.map[r<<16^n]=[]),e.push(h);return t},boundaries:function(){var t,e,i={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}},r={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}};for(var n in this.map)if(this.map[n].length){var s=n>>16,a=n<<16>>16;if(a<0&&(s^=-1),s>=i.max.x)for(t in i.max.x=s,this.map[n])"object"==typeof(e=this.map[n][t])&&"requires"in e&&(r.max.x=Math.max(r.max.x,e.x+e.w));if(s<=i.min.x)for(t in i.min.x=s,this.map[n])"object"==typeof(e=this.map[n][t])&&"requires"in e&&(r.min.x=Math.min(r.min.x,e.x));if(a>=i.max.y)for(t in i.max.y=a,this.map[n])"object"==typeof(e=this.map[n][t])&&"requires"in e&&(r.max.y=Math.max(r.max.y,e.y+e.h));if(a<=i.min.y)for(t in i.min.y=a,this.map[n])"object"==typeof(e=this.map[n][t])&&"requires"in e&&(r.min.y=Math.min(r.min.y,e.y))}return r}},i.key=function(t,i){return t._mbr&&(t=t._mbr),i||(i={}),i.x1=Math.floor(t._x/e),i.y1=Math.floor(t._y/e),i.x2=Math.floor((t._w+t._x)/e),i.y2=Math.floor((t._h+t._y)/e),i},i.hash=function(t){return t.x1+" "+t.y1+" "+t.x2+" "+t.y2},n.prototype={update:function(t){i.hash(i.key(t,r))!=i.hash(this.keys)&&this.map.refresh(this)}},t.HashMap=i}(Crafty),Crafty.map=new Crafty.HashMap;var M=Math,Mc=M.cos,Ms=M.sin,PI=M.PI,DEG_TO_RAD=PI/180,active,dragging,lastMouse,prop,act;Crafty.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_defineGetterSetter_setter:function(){this.__defineSetter__("x",function(t){this._attr("_x",t)}),this.__defineSetter__("y",function(t){this._attr("_y",t)}),this.__defineSetter__("w",function(t){this._attr("_w",t)}),this.__defineSetter__("h",function(t){this._attr("_h",t)}),this.__defineSetter__("z",function(t){this._attr("_z",t)}),this.__defineSetter__("rotation",function(t){this._attr("_rotation",t)}),this.__defineSetter__("alpha",function(t){this._attr("_alpha",t)}),this.__defineSetter__("visible",function(t){this._attr("_visible",t)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y}),this.__defineGetter__("w",function(){return this._w}),this.__defineGetter__("h",function(){return this._h}),this.__defineGetter__("z",function(){return this._z}),this.__defineGetter__("rotation",function(){return this._rotation}),this.__defineGetter__("alpha",function(){return this._alpha}),this.__defineGetter__("visible",function(){return this._visible}),this.__defineGetter__("parent",function(){return this._parent}),this.__defineGetter__("numChildren",function(){return this._children.length})},_defineGetterSetter_defineProperty:function(){Object.defineProperty(this,"x",{set:function(t){this._attr("_x",t)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(t){this._attr("_y",t)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"w",{set:function(t){this._attr("_w",t)},get:function(){return this._w},configurable:!0}),Object.defineProperty(this,"h",{set:function(t){this._attr("_h",t)},get:function(){return this._h},configurable:!0}),Object.defineProperty(this,"z",{set:function(t){this._attr("_z",t)},get:function(){return this._z},configurable:!0}),Object.defineProperty(this,"rotation",{set:function(t){this._attr("_rotation",t)},get:function(){return this._rotation},configurable:!0}),Object.defineProperty(this,"alpha",{set:function(t){this._attr("_alpha",t)},get:function(){return this._alpha},configurable:!0}),Object.defineProperty(this,"visible",{set:function(t){this._attr("_visible",t)},get:function(){return this._visible},configurable:!0})},_defineGetterSetter_fallback:function(){this.x=this._x,this.y=this._y,this.w=this._w,this.h=this._h,this.z=this._z,this.rotation=this._rotation,this.alpha=this._alpha,this.visible=this._visible,this.bind("EnterFrame",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var t=this.mbr()||this.pos();if(this.rotation!==this._rotation)this._rotate(this.rotation);else{var e=this._mbr,i=!1;e&&(this.x!==this._x?(e._x-=this.x-this._x,i=!0):this.y!==this._y?(e._y-=this.y-this._y,i=!0):this.w!==this._w?(e._w-=this.w-this._w,i=!0):this.h!==this._h?(e._h-=this.h-this._h,i=!0):this.z!==this._z&&(e._z-=this.z-this._z,i=!0)),i&&this.trigger("Move",t)}this._x=this.x,this._y=this.y,this._w=this.w,this._h=this.h,this._z=this.z,this._rotation=this.rotation,this._alpha=this.alpha,this._visible=this.visible,this.trigger("Change",t),this.trigger("Move",t)}})},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._children=[],Crafty.support.setter?this._defineGetterSetter_setter():Crafty.support.defineProperty?this._defineGetterSetter_defineProperty():this._defineGetterSetter_fallback(),this._entry=Crafty.map.insert(this),this.bind("Move",function(t){var e=this._mbr||this;this._entry.update(e),this._cascade(t)}),this.bind("Rotate",function(t){var e=this._mbr||this;this._entry.update(e),this._cascade(t)}),this.bind("Remove",function(){if(this._children){for(var t=0;t<this._children.length;t++)delete this._children[t]._parent,this._children[t].destroy&&this._children[t].destroy();this._children=[]}this._parent&&this._parent.detach(this),Crafty.map.remove(this),this.detach()})},_rotate:function(t){var e=t%360*-1,i=e*DEG_TO_RAD,r=Math.cos(i),n=Math.sin(i),s={x:this._origin.x+this._x,y:this._origin.y+this._y};if(e||(this._mbr=null,!(!this._rotation%360))){var a=s.x+(this._x-s.x)*r+(this._y-s.y)*n,o=s.y-(this._x-s.x)*n+(this._y-s.y)*r,h=s.x+(this._x+this._w-s.x)*r+(this._y-s.y)*n,u=s.y-(this._x+this._w-s.x)*n+(this._y-s.y)*r,f=s.x+(this._x+this._w-s.x)*r+(this._y+this._h-s.y)*n,c=s.y-(this._x+this._w-s.x)*n+(this._y+this._h-s.y)*r,l=s.x+(this._x-s.x)*r+(this._y+this._h-s.y)*n,d=s.y-(this._x-s.x)*n+(this._y+this._h-s.y)*r,y=Math.floor(Math.min(a,h,f,l)),p=Math.floor(Math.min(o,u,c,d)),_=Math.ceil(Math.max(a,h,f,l)),m=Math.ceil(Math.max(o,u,c,d));this._mbr={_x:y,_y:p,_w:_-y,_h:m-p};var g=this._rotation-t,v=g*DEG_TO_RAD;this.trigger("Rotate",{cos:Math.cos(v),sin:Math.sin(v),deg:g,rad:v,o:{x:s.x,y:s.y},matrix:{M11:r,M12:n,M21:-n,M22:r}})}},area:function(){return this._w*this._h},intersect:function(t,e,i,r){var n,s=this._mbr||this;return n="object"==typeof t?t:{x:t,y:e,w:i,h:r},s._x<n.x+n.w&&s._x+s._w>n.x&&s._y<n.y+n.h&&s._h+s._y>n.y},within:function(t,e,i,r){var n;return(n="object"==typeof t?t:{x:t,y:e,w:i,h:r}).x<=this.x&&n.x+n.w>=this.x+this.w&&n.y<=this.y&&n.y+n.h>=this.y+this.h},contains:function(t,e,i,r){var n;return(n="object"==typeof t?t:{x:t,y:e,w:i,h:r}).x>=this.x&&n.x+n.w<=this.x+this.w&&n.y>=this.y&&n.y+n.h<=this.y+this.h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(t,e){return this.mapArea?this.mapArea.containsPoint(t,e):this.map?this.map.containsPoint(t,e):this.x<=t&&this.x+this.w>=t&&this.y<=e&&this.y+this.h>=e},move:function(t,e){return"n"===t.charAt(0)&&(this.y-=e),"s"===t.charAt(0)&&(this.y+=e),"e"!==t&&"e"!==t.charAt(1)||(this.x+=e),"w"!==t&&"w"!==t.charAt(1)||(this.x-=e),this},shift:function(t,e,i,r){return t&&(this.x+=t),e&&(this.y+=e),i&&(this.w+=i),r&&(this.h+=r),this},_cascade:function(t){if(t){var e,i=0,r=this._children,n=r.length;if(t.cos)for(;i<n;++i)"rotate"in(e=r[i])&&e.rotate(t);else for(var s=this._mbr||this,a=s._x-t._x,o=s._y-t._y,h=s._w-t._w,u=s._h-t._h;i<n;++i)(e=r[i]).shift(a,o,h,u)}},attach:function(){for(var t,e=0,i=arguments,r=arguments.length;e<r;++e)(t=i[e])._parent&&t._parent.detach(t),t._parent=this,this._children.push(t);return this},detach:function(t){if(!t){for(var e=0;e<this._children.length;e++)this._children[e]._parent=null;return this._children=[],this}for(e=0;e<this._children.length;e++)this._children[e]==t&&this._children.splice(e,1);return t._parent=null,this},origin:function(t,e){if("string"==typeof t)if("centre"===t||"center"===t||-1===t.indexOf(" "))t=this._w/2,e=this._h/2;else{var i=t.split(" ");"top"===i[0]?e=0:"bottom"===i[0]?e=this._h:"middle"!==i[0]&&"center"!==i[1]&&"centre"!==i[1]||(e=this._h/2),"center"===i[1]||"centre"===i[1]||"middle"===i[1]?t=this._w/2:"left"===i[1]?t=0:"right"===i[1]&&(t=this._w)}return this._origin.x=t,this._origin.y=e,this},flip:function(t){this["_flip"+(t=t||"X")]||(this["_flip"+t]=!0,this.trigger("Change"))},unflip:function(t){this["_flip"+(t=t||"X")]&&(this["_flip"+t]=!1,this.trigger("Change"))},rotate:function(t){this._origin.x=t.o.x-this._x,this._origin.y=t.o.y-this._y,this._attr("_rotation",this._rotation-t.deg)},_attr:function(t,e){if(this[t]!==e){var i=this.pos(),r=this.mbr()||i;if("_rotation"===t)this._rotate(e),this.trigger("Rotate");else if("_z"===t)this._globalZ=parseInt(e+Crafty.zeroFill(this[0],5),10),this.trigger("reorder");else if("_x"==t||"_y"===t||"_w"===t||"_h"===t){var n=this._mbr;n&&(n[t]-=this[t]-e),this[t]=e,this.trigger("Move",r)}this[t]=e,this.trigger("Change",r)}}}),Crafty.c("Physics",{_gravity:.4,_friction:.2,_bounce:.5,gravity:function(t){this._gravity=t}}),Crafty.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(t){return t&&(this._anti=t),this.bind("EnterFrame",this._enterFrame),this},gravityConst:function(t){return this._gravityConst=t,this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy):this._gy=0;var t,e,i,r=!1,n=this.pos(),s=0;for(n._y++,n.x=n._x,n.y=n._y,n.w=n._w,n.h=n._h,i=(e=Crafty.map.search(n)).length;s<i;++s)if((t=e[s])!==this&&t.has(this._anti)&&t.intersect(n)){r=t;break}r?this._falling&&this.stopFalling(r):this._falling=!0},stopFalling:function(t){t&&(this.y=t._y-this._h),this._falling=!1,this._up&&(this._up=!1),this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}}),Crafty.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0)),this.points=t},Crafty.polygon.prototype={containsPoint:function(t,e){var i,r,n=this.points,s=!1;for(i=0,r=n.length-1;i<n.length;r=i++)n[i][1]>e!=n[r][1]>e&&t<(n[r][0]-n[i][0])*(e-n[i][1])/(n[r][1]-n[i][1])+n[i][0]&&(s=!s);return s},shift:function(t,e){for(var i,r=0,n=this.points.length;r<n;r++)(i=this.points[r])[0]+=t,i[1]+=e},rotate:function(t){for(var e,i,r,n=0,s=this.points.length;n<s;n++)e=this.points[n],i=t.o.x+(e[0]-t.o.x)*t.cos+(e[1]-t.o.y)*t.sin,r=t.o.y-(e[0]-t.o.x)*t.sin+(e[1]-t.o.y)*t.cos,e[0]=i,e[1]=r}},Crafty.circle=function(t,e,i){var r;this.x=t,this.y=e,this.radius=i,this.points=[];for(var n=0;n<8;n++)r=n*Math.PI/4,this.points[n]=[this.x+Math.sin(r)*i,this.y+Math.cos(r)*i]},Crafty.circle.prototype={containsPoint:function(t,e){var i=this.radius,r=(Math.sqrt,this.x-t),n=this.y-e;return r*r+n*n<i*i},shift:function(t,e){this.x+=t,this.y+=e;for(var i,r=0,n=this.points.length;r<n;r++)(i=this.points[r])[0]+=t,i[1]+=e},rotate:function(){}},Crafty.matrix=function(t){this.mtx=t,this.width=t[0].length,this.height=t.length},Crafty.matrix.prototype={x:function(t){if(this.width==t.height){for(var e=[],i=0;i<this.height;i++){e[i]=[];for(var r=0;r<t.width;r++){for(var n=0,s=0;s<this.width;s++)n+=this.mtx[i][s]*t.mtx[s][r];e[i][r]=n}}return new Crafty.matrix(e)}},e:function(t,e){return t<1||t>this.mtx.length||e<1||e>this.mtx[0].length?null:this.mtx[t-1][e-1]}},Crafty.c("Collision",{init:function(){this.requires("2D");var t=this._mbr||this,e=new Crafty.polygon([0,0],[t._w,0],[t._w,t._h],[0,t._h]);this.map=e,this.attach(this.map),this.map.shift(t._x,t._y)},collision:function(t){var e=this._mbr||this;if(t||(t=new Crafty.polygon([0,0],[e._w,0],[e._w,e._h],[0,e._h])),arguments.length>1){var i=Array.prototype.slice.call(arguments,0);t=new Crafty.polygon(i)}return this.map=t,this.attach(this.map),this.map.shift(e._x,e._y),this},hit:function(t){var e,i,r,n,s=this._mbr||this,a=Crafty.map.search(s,!1),o=0,h=a.length,u={},f="map"in this&&"containsPoint"in this.map,c=[];if(!h)return!1;for(;o<h;++o)r=(i=a[o])._mbr||i,i&&!u[e=i[0]]&&this[0]!==e&&i.__c[t]&&r._x<s._x+s._w&&r._x+r._w>s._x&&r._y<s._y+s._h&&r._h+r._y>s._y&&(u[e]=i);for(n in u)if(i=u[n],f&&"map"in i){var l=this._SAT(this.map,i.map);l.obj=i,l.type="SAT",l&&c.push(l)}else c.push({obj:i,type:"MBR"});return!!c.length&&c},onHit:function(t,e,i){var r=!1;return this.bind("EnterFrame",function(){var n=this.hit(t);n?(r=!0,e.call(this,n)):r&&("function"==typeof i&&i.call(this),r=!1)}),this},_SAT:function(t,e){for(var i,r,n,s,a,o,h,u,f,c,l=t.points,d=e.points,y=0,p=l.length,_=d.length,m={x:0,y:0},g=null,v=null,C=null;y<p;y++){for(f=l[y==p-1?0:y+1],c=l[y],m.x=-(f[1]-c[1]),m.y=f[0]-c[0],r=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=r,m.y/=r,n=s=-1,a=o=-1,i=0;i<p;++i)((u=l[i][0]*m.x+l[i][1]*m.y)>a||-1===a)&&(a=u),(u<n||-1===n)&&(n=u);for(i=0;i<_;++i)((u=d[i][0]*m.x+d[i][1]*m.y)>o||-1===o)&&(o=u),(u<s||-1===s)&&(s=u);if(n<s?(h=s-a,m.x=-m.x,m.y=-m.y):h=n-o,h>=0)return!1;(null===g||h>g)&&(g=h,C={x:m.x,y:m.y})}for(y=0;y<_;y++){for(f=d[y==_-1?0:y+1],c=d[y],m.x=-(f[1]-c[1]),m.y=f[0]-c[0],r=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=r,m.y/=r,n=s=-1,a=o=-1,i=0;i<p;++i)((u=l[i][0]*m.x+l[i][1]*m.y)>a||-1===a)&&(a=u),(u<n||-1===n)&&(n=u);for(i=0;i<_;++i)((u=d[i][0]*m.x+d[i][1]*m.y)>o||-1===o)&&(o=u),(u<s||-1===s)&&(s=u);if(n<s?(h=s-a,m.x=-m.x,m.y=-m.y):h=n-o,h>=0)return!1;(null===g||h>g)&&(g=h),(h>v||null===v)&&(v=h,C={x:m.x,y:m.y})}return{overlap:v,normal:C}}}),Crafty.c("WiredHitBox",{init:function(){if(Crafty.support.canvas){var t=document.getElementById("HitBox");t||((t=document.createElement("canvas")).id="HitBox",t.width=Crafty.viewport.width,t.height=Crafty.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex="1000",Crafty.stage.elem.appendChild(t));var e=t.getContext("2d"),i=0,r=Crafty("WiredHitBox").length,n=function(){for(var t in i==r&&(e.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),i=0),e.beginPath(),this.map.points)e.lineTo(Crafty.viewport.x+this.map.points[t][0],Crafty.viewport.y+this.map.points[t][1]);e.closePath(),e.stroke(),i++};this.requires("Collision").bind("EnterFrame",n),this.bind("RemoveComponent",function(t){"WiredHitBox"==t&&(this.unbind("EnterFrame",n),i==r&&(e.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),i=0))})}return this}}),Crafty.c("SolidHitBox",{init:function(){if(Crafty.support.canvas){var t=document.getElementById("HitBox");t||((t=document.createElement("canvas")).id="HitBox",t.width=Crafty.viewport.width,t.height=Crafty.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex="1000",Crafty.stage.elem.appendChild(t));var e=t.getContext("2d"),i=0,r=Crafty("SolidHitBox").length,n=function(){for(var t in i==r&&(e.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),i=0),e.beginPath(),this.map.points)e.lineTo(Crafty.viewport.x+this.map.points[t][0],Crafty.viewport.y+this.map.points[t][1]);e.closePath(),e.fill(),i++};this.requires("Collision").bind("EnterFrame",n),this.bind("RemoveComponent",function(t){"SolidHitBox"==t&&(this.unbind("EnterFrame",n),i==r&&(e.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),i=0))})}return this}}),Crafty.c("DOM",{_element:null,_cssStyles:null,init:function(){function t(){var t=0,e=this.__c,i="";for(t in e)i+=" "+t;i=i.substr(1),this._element.className=i}this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=document.createElement("div"),Crafty.stage.inner.appendChild(this._element),this._element.style.position="absolute",this._element.id="ent"+this[0],this.bind("Change",function(){this._changed||(this._changed=!0,Crafty.DrawManager.addDom(this))}),this.bind("NewComponent",t).bind("RemoveComponent",t),"ms"===Crafty.support.prefix&&Crafty.support.version<9&&(this._filters={},this.bind("Rotate",function(t){var e=t.matrix,i=(this._element.style,e.M11.toFixed(8)),r=e.M12.toFixed(8),n=e.M21.toFixed(8),s=e.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+i+", M12="+r+", M21="+n+", M22="+s+",sizingMethod='auto expand')"})),this.bind("Remove",this.undraw),this.bind("RemoveComponent",function(t){"DOM"===t&&this.undraw()})},getDomId:function(){return this._element.id},DOM:function(t){return t&&t.nodeType&&(this.undraw(),this._element=t,this._element.style.position="absolute"),this},draw:function(){var t=this._element.style,e=this.__coord||[0,0,0,0],i={x:e[0],y:e[1]},r=Crafty.support.prefix,n=[];if(this._cssStyles.visibility!==this._visible&&(this._cssStyles.visibility=this._visible,this._visible?t.visibility="visible":t.visibility="hidden"),Crafty.support.css3dtransform?n.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!==this._x&&(this._cssStyles.left=this._x,t.left=~~this._x+"px"),this._cssStyles.top!==this._y&&(this._cssStyles.top=this._y,t.top=~~this._y+"px")),this._cssStyles.width!==this._w&&(this._cssStyles.width=this._w,t.width=~~this._w+"px"),this._cssStyles.height!==this._h&&(this._cssStyles.height=this._h,t.height=~~this._h+"px"),this._cssStyles.zIndex!==this._z&&(this._cssStyles.zIndex=this._z,t.zIndex=this._z),this._cssStyles.opacity!==this._alpha&&(this._cssStyles.opacity=this._alpha,t.opacity=this._alpha,t[r+"Opacity"]=this._alpha),"ms"===r&&Crafty.support.version<9&&(8===Crafty.support.version?this._filters.alpha="progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*this._alpha+")":this._filters.alpha="alpha(opacity="+100*this._alpha+")"),this._mbr){var s=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=s,t[r+"TransformOrigin"]=s,Crafty.support.css3dtransform?n.push("rotateZ("+this._rotation+"deg)"):n.push("rotate("+this._rotation+"deg)")}return this._flipX&&(n.push("scaleX(-1)"),"ms"===r&&Crafty.support.version<9&&(this._filters.flipX="fliph")),this._flipY&&(n.push("scaleY(-1)"),"ms"===r&&Crafty.support.version<9&&(this._filters.flipY="flipv")),"ms"===r&&Crafty.support.version<9&&this.applyFilters(),this._cssStyles.transform!=n.join(" ")&&(this._cssStyles.transform=n.join(" "),t.transform=this._cssStyles.transform,t[r+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:t,type:"DOM",co:i}),this},applyFilters:function(){this._element.style.filter="";var t="";for(var e in this._filters)this._filters.hasOwnProperty(e)&&(t+=this._filters[e]+" ");this._element.style.filter=t},undraw:function(){return this._element&&Crafty.stage.inner.removeChild(this._element),this},css:function(t,e){var i,r,n=this._element,s=n.style;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&("number"==typeof(r=t[i])&&(r+="px"),s[Crafty.DOM.camelize(i)]=r);else{if(!e)return Crafty.DOM.getStyle(n,t);"number"==typeof e&&(e+="px"),s[Crafty.DOM.camelize(t)]=e}return this.trigger("Change"),this}});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(t){}function tweenEnterFrame(t){if(!(this._numProps<=0)){var e,i;for(i in this._step)e=this._step[i],this[i]+=e.val,0==--e.rem&&(this[i]=e.prop,this.trigger("TweenEnd",i),this._step[i].rem<=0&&delete this._step[i],this._numProps--);if(this.has("Mouse")){var r=Crafty.over,n=Crafty.mousePos;r&&r[0]==this[0]&&!this.isAt(n.x,n.y)?(this.trigger("MouseOut",Crafty.lastEvent),Crafty.over=null):r&&r[0]==this[0]||!this.isAt(n.x,n.y)||(Crafty.over=this,this.trigger("MouseOver",Crafty.lastEvent))}}}Crafty.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight},width:0,height:0},inner:function(t){var e=t.getBoundingClientRect(),i=e.left+(window.pageXOffset?window.pageXOffset:document.body.scrollLeft),r=e.top+(window.pageYOffset?window.pageYOffset:document.body.scrollTop);return{x:i+=parseInt(this.getStyle(t,"border-left-width")||0,10)||parseInt(this.getStyle(t,"borderLeftWidth")||0,10)||0,y:r+=parseInt(this.getStyle(t,"border-top-width")||0,10)||parseInt(this.getStyle(t,"borderTopWidth")||0,10)||0}},getStyle:function(t,e){var i;return t.currentStyle?i=t.currentStyle[this.camelize(e)]:window.getComputedStyle&&(i=document.defaultView.getComputedStyle(t,null).getPropertyValue(this.csselize(e))),i},camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},csselize:function(t){return t.replace(/[A-Z]/g,function(t){return t?"-"+t.toLowerCase():""})},translate:function(t,e){return{x:(t-Crafty.stage.x+document.body.scrollLeft+document.documentElement.scrollLeft-Crafty.viewport._x)/Crafty.viewport._zoom,y:(e-Crafty.stage.y+document.body.scrollTop+document.documentElement.scrollTop-Crafty.viewport._y)/Crafty.viewport._zoom}}}}),Crafty.c("FPS",{values:[],maxValues:60,init:function(){this.bind("MessureFPS",function(t){this.values.length>this.maxValues&&this.values.splice(0,1),this.values.push(t.value)})}}),Crafty.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(t){return this.inner=t,this._element.innerHTML=t,this},append:function(t){return this.inner+=t,this._element.innerHTML+=t,this},prepend:function(t){return this.inner=t+this.inner,this._element.innerHTML=t+this.inner,this}}),Crafty.storage=function(){var db=null,url,gameName,timestamps={},transactionType={READ:"readonly",READ_WRITE:"readwrite"};function process(t){if(t.c)return Crafty.e(t.c).attr(t.attr).trigger("LoadData",t,process);if("object"==typeof t)for(var e in t)t[e]=process(t[e]);return t}function unserialize(str){if("string"!=typeof str)return null;var data=JSON?JSON.parse(str):eval("("+str+")");return process(data)}function prep(t){if(t.__c){var e={c:[],attr:{}};for(var i in t.trigger("SaveData",e,prep),t.__c)e.c.push(i);e.c=e.c.join(", "),t=e}else if("object"==typeof t)for(var r in t)t[r]=prep(t[r]);return t}function serialize(t){if(JSON){var e=prep(t);return JSON.stringify(e)}return alert("Crafty does not support saving on your browser. Please upgrade to a newer browser."),!1}function external(t){url=t}function openExternal(){if(void 0!==url){var xml=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(4==xhr.readyState&&200==xhr.status){var data=eval("("+xhr.responseText+")");for(var i in data)Crafty.storage.check(data[i].key,data[i].timestamp)&&loadExternal(data[i].key)}},xhr.send("mode=timestamps&game="+gameName)}}function saveExternal(t,e,i){if(void 0!==url){var r=new XMLHttpRequest;r.open("POST",url),r.send("mode=save&key="+t+"&data="+encodeURIComponent(e)+"&ts="+i+"&game="+gameName)}}function loadExternal(key){if(void 0!==url){var xhr=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(4==xhr.readyState&&200==xhr.status){var data=eval("("+xhr.responseText+")");Crafty.storage.save(key,"save",data)}},xhr.send("mode=load&key="+key+"&game="+gameName)}}function ts(){return(new Date).getTime()}return"object"!=typeof indexedDB&&(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,"object"==typeof IDBTransaction&&(transactionType.READ=IDBTransaction.READ||IDBTransaction.readonly||transactionType.READ||"read",transactionType.READ_WRITE=IDBTransaction.READ_WRITE||IDBTransaction.readwrite||transactionType.READ_WRITE||"readwrite")),"object"==typeof indexedDB?{open:function(t){gameName=t;var e=[];if(1==arguments.length?(e.push("save"),e.push("cache")):((e=arguments).shift(),e.push("save"),e.push("cache")),null==db){var i=indexedDB.open(gameName);i.onsuccess=function(t){db=t.target.result,r(),openExternal()},i.onupgradeneeded=function(t){n()}}else n(),r(),openExternal();function r(){try{db.transaction(["save"],"read").objectStore("save").getAll().onsuccess=function(t){for(var e=0,i=event.target.result,r=i.length;e<r;e++)timestamps[i[e].key]=i[e].timestamp}}catch(t){}}function n(){db.setVersion("1.0").onsuccess=function(t){for(var i=0;i<e.length;i++){var r=e[i];if(!db.objectStoreNames.contains(r))db.createObjectStore(r,{keyPath:"key"})}}}},save:function(t,e,i,r){if(null!=db){var n=serialize(i),s=ts();"save"==e&&saveExternal(t,n,s);try{var a=db.transaction([e],transactionType.READ_WRITE).objectStore(e).add({data:n,timestamp:s,key:t});"function"==typeof r&&(a.onsuccess=r)}catch(t){console.error(t)}}else setTimeout(function(){Crafty.storage.save(t,e,i)},1)},load:function(t,e,i){if(null!=db)try{db.transaction([e],transactionType.READ).objectStore(e).get(t).onsuccess=function(t){i(unserialize(t.target.result.data))}}catch(t){console.error(t)}else setTimeout(function(){Crafty.storage.load(t,e,i)},1)},getAllKeys:function(t,e){null==db&&setTimeout(function(){Crafty.storage.getAllkeys(t,e)},1);try{var i=db.transaction([t],transactionType.READ).objectStore(t).openCursor(),r=[];i.onsuccess=function(t){var i=t.target.result;i?(r.push(i.key),i.continue()):e(r)}}catch(t){console.error(t)}},check:function(t,e){return timestamps[t]>e},external:external}:"function"==typeof openDatabase?{open:function(t){if(gameName=t,1==arguments.length)db={save:openDatabase(t+"_save","1.0","Saves games for "+t,5242880),cache:openDatabase(t+"_cache","1.0","Cache for "+t,5242880)};else{var e=arguments,i=0;for(e.shift();i<e.length;i++)void 0===db[e[i]]&&(db[e[i]]=openDatabase(gameName+"_"+e[i],"1.0",type,5242880))}db.save.transaction(function(t){t.executeSql("SELECT key, timestamp FROM data",[],function(t,e){for(var i=0,r=e.rows,n=r.length;i<n;i++)timestamps[r.item(i).key]=r.item(i).timestamp})})},save:function(t,e,i){void 0===db[e]&&""!=gameName&&this.open(gameName,e);var r=serialize(i),n=ts();"save"==e&&saveExternal(t,r,n),db[e].transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS data (key unique, text, timestamp)"),e.executeSql("SELECT * FROM data WHERE key = ?",[t],function(e,i){i.rows.length?e.executeSql("UPDATE data SET text = ?, timestamp = ? WHERE key = ?",[r,n,t]):e.executeSql("INSERT INTO data VALUES (?, ?, ?)",[t,r,n])})})},load:function(t,e,i){null!=db[e]?db[e].transaction(function(e){e.executeSql("SELECT text FROM data WHERE key = ?",[t],function(t,e){e.rows.length&&(res=unserialize(e.rows.item(0).text),i(res))})}):setTimeout(function(){Crafty.storage.load(t,e,i)},1)},getAllKeys:function(t,e){null!=db[t]?db[t].transaction(function(t){t.executeSql("SELECT key FROM data",[],function(t,i){e(i.rows)})}):setTimeout(function(){Crafty.storage.getAllKeys(t,e)},1)},check:function(t,e){return timestamps[t]>e},external:external}:"object"==typeof window.localStorage?{open:function(t){gameName=t},save:function(t,e,i){var r=gameName+"."+e+"."+t,n=serialize(i),s=ts();"save"==e&&saveExternal(t,n,s),window.localStorage[r]=n,"save"==e&&(window.localStorage[r+".ts"]=s)},load:function(t,e,i){var r=gameName+"."+e+"."+t;i(unserialize(window.localStorage[r]))},getAllKeys:function(t,e){var i={},r=[],n=gameName+"."+t;for(var s in window.localStorage){if(-1!=s.indexOf(n))i[s.replace(n,"").replace(".ts","")]=!0}for(s in i)r.push(s);e(r)},check:function(t,e){var i=window.localStorage[gameName+".save."+t+".ts"];return parseInt(e)>parseInt(i)},external:external}:{open:function(t){gameName=t},save:function(t,e,i){if("save"==e){var r=serialize(i),n=ts();"save"==e&&saveExternal(t,r,n),document.cookie=gameName+"_"+t+"="+r+"; "+gameName+"_"+t+"_ts="+n+"; expires=Thur, 31 Dec 2099 23:59:59 UTC; path=/"}},load:function(t,e,i){"save"==e&&i(unserialize(new RegExp(gameName+"_"+t+"=[^;]*").exec(document.cookie)[0].replace(gameName+"_"+t+"=","")))},getAllKeys:function(t,e){if("save"==t){for(var i=new RegExp(gameName+"_[^_=]","g").exec(document.cookie),r=0,n=i.length,s={},a=[];r<n;r++){s[i[r].replace(gameName+"_","")]=!0}for(r in s)a.push(r);e(a)}},check:function(t,e){var i=gameName+"_"+t+"_ts",r=new RegExp(i+"=[^;]").exec(document.cookie)[0].replace(i+"=","");return parseInt(e)>parseInt(r)},external:external}}(),function(){var t=Crafty.support={},e=navigator.userAgent.toLowerCase(),i=/(webkit)[ \/]([\w.]+)/.exec(e)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(ms)ie ([\w.]+)/.exec(e)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(e)||[],r=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(e);if(r&&(Crafty.mobile=r[0]),t.setter="__defineSetter__"in this&&"__defineGetter__"in this,t.defineProperty=function(){if(!1 in Object)return!1;try{Object.defineProperty({},"x",{})}catch(t){return!1}return!0}(),t.audio="Audio"in window,t.prefix=i[1]||i[0],"moz"===t.prefix&&(t.prefix="Moz"),"o"===t.prefix&&(t.prefix="O"),i[2]&&(t.versionName=i[2],t.version=+i[2].split(".")[0]),t.canvas="getContext"in document.createElement("canvas"),t.canvas){var n;try{(n=document.createElement("canvas").getContext("experimental-webgl")).viewportWidth=t.canvas.width,n.viewportHeight=t.canvas.height}catch(t){}t.webgl=!!n}else t.webgl=!1;t.css3dtransform=void 0!==document.createElement("div").style.Perspective||void 0!==document.createElement("div").style[t.prefix+"Perspective"],t.deviceorientation=void 0!==window.DeviceOrientationEvent||void 0!==window.OrientationEvent,t.devicemotion=void 0!==window.DeviceMotionEvent}(),Crafty.extend({zeroFill:function(t,e){return(e-=t.toString().length)>0?new Array(e+(/\./.test(t)?2:1)).join("0")+t:t.toString()},sprite:function(t,e,i,r,n,s){var a,o,h,u,f,c,l;for(a in"string"==typeof t&&(s=n,n=r,r=e,i=t,t=1,e=1),"string"==typeof e&&(s=n,n=r,r=i,i=e,e=t),!s&&n&&(s=n),n=parseInt(n||0,10),s=parseInt(s||0,10),(l=Crafty.asset(i))||((l=new Image).src=i,Crafty.asset(i,l),l.onload=function(){for(a in r)Crafty(a).each(function(){this.ready=!0,this.trigger("Change")})}),r)r.hasOwnProperty(a)&&(h=(o=r[a])[0]*(t+n),u=o[1]*(e+s),f=o[2]*t||t,c=o[3]*e||e,Crafty.c(a,{ready:!1,__coord:[h,u,f,c],init:function(){this.requires("Sprite"),this.__trim=[0,0,0,0],this.__image=i,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=e,this.__padding=[n,s],this.img=l,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Change")),this.w=this.__coord[2],this.h=this.__coord[3]}}));return this},_events:{},addEvent:function(t,e,i,r){3===arguments.length&&(r=i,i=e,e=window.document);var n=function(e){e=e||window.event;"function"==typeof r&&r.call(t,e)},s=t[0]||"";this._events[s+e+i+r]||(this._events[s+e+i+r]=n,e.attachEvent?e.attachEvent("on"+i,n):e.addEventListener(i,n,!1))},removeEvent:function(t,e,i,r){3===arguments.length&&(r=i,i=e,e=window.document);var n=t[0]||"",s=this._events[n+e+i+r];s&&(e.detachEvent?e.detachEvent("on"+i,s):e.removeEventListener(i,s,!1),delete this._events[n+e+i+r])},background:function(t){Crafty.stage.elem.style.background=t},viewport:{clampToEntities:!0,width:0,height:0,_x:0,_y:0,bounds:null,scroll:function(t,e){var i=(e=Math.floor(e))-this[t],r=Crafty.canvas.context,n=Crafty.stage.inner.style;this[t]=e,r&&("_x"==t?r.translate(i,0):r.translate(0,i),Crafty.DrawManager.drawAll()),n["_x"==t?"left":"top"]=e+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},pan:function(){var t,e={},i=!1;function r(i){var r=0;for(t in e){var n=e[t];n.remTime>0?(n.current+=n.diff,n.remTime--,Crafty.viewport[t]=Math.floor(n.current),r++):delete e[t]}r&&Crafty.viewport._clamp()}return function(n,s,a){if(Crafty.viewport.follow(),"reset"!=n)0==a&&(a=1),e[n]={diff:-s/a,current:Crafty.viewport[n],remTime:a},i||(Crafty.bind("EnterFrame",r),i=!0);else for(t in e)e[t].remTime=0}}(),follow:function(){var t,e,i;function r(){Crafty.viewport.scroll("_x",-(this.x+this.w/2-Crafty.viewport.width/2-e)),Crafty.viewport.scroll("_y",-(this.y+this.h/2-Crafty.viewport.height/2-i)),Crafty.viewport._clamp()}return function(n,s,a){t&&t.unbind("Change",r),n&&n.has("2D")&&(Crafty.viewport.pan("reset"),t=n,e=void 0!==s?s:0,i=void 0!==a?a:0,n.bind("Change",r),r.call(n))}}(),centerOn:function(t,e){var i=t.x,r=t.y,n=t.w/2,s=t.h/2,a=i+n-Crafty.viewport.width/2,o=r+s-Crafty.viewport.height/2;Crafty.viewport.pan("reset"),Crafty.viewport.pan("x",a,e),Crafty.viewport.pan("y",o,e)},_zoom:1,zoom:function(){var t=1,e=0,i=0,r=Crafty.support.prefix+"Transform",n=!1,s={},a={};function o(){if(i>0){isFinite(Crafty.viewport._zoom)&&(t=Crafty.viewport._zoom);var n={width:s.width*t,height:s.height*t};t+=e,Crafty.viewport._zoom=t;var o={width:s.width*t,height:s.height*t},h={width:o.width-n.width,height:o.height-n.height};if(Crafty.stage.inner.style[r]="scale("+t+","+t+")",Crafty.canvas._canvas){var u=t/(t-e);Crafty.canvas.context.scale(u,u),Crafty.DrawManager.drawAll()}Crafty.viewport.x-=h.width*a.width,Crafty.viewport.y-=h.height*a.height,i--}}return function(r,h,u,f){var c=this.bounds||Crafty.map.boundaries(),l=r?t*r:1;r||(t=1,this._zoom=1),s.width=c.max.x-c.min.x,s.height=c.max.y-c.min.y,a.width=h/s.width,a.height=u/s.height,0==f&&(f=1),e=(l-t)/f,i=f,Crafty.viewport.pan("reset"),n||(Crafty.bind("EnterFrame",o),n=!0)}}(),scale:(prop=Crafty.support.prefix+"Transform",act={},function(t){var e=this.bounds||Crafty.map.boundaries(),i=t?this._zoom*t:1,r=i/this._zoom;this._zoom=i,act.width=e.max.x-e.min.x,act.height=e.max.y-e.min.y,act.width,act.height,Crafty.viewport.pan("reset"),Crafty.stage.inner.style.transform=Crafty.stage.inner.style[prop]="scale("+this._zoom+","+this._zoom+")",Crafty.canvas._canvas&&(Crafty.canvas.context.scale(r,r),Crafty.DrawManager.drawAll())}),mouselook:(active=!1,dragging=!1,lastMouse={},old={},function(t,e){if("boolean"!=typeof t){if(active)switch(t){case"move":case"drag":if(!dragging)return;diff={x:e.clientX-lastMouse.x,y:e.clientY-lastMouse.y},Crafty.viewport.x+=diff.x,Crafty.viewport.y+=diff.y,Crafty.viewport._clamp();case"start":lastMouse.x=e.clientX,lastMouse.y=e.clientY,dragging=!0;break;case"stop":dragging=!1}}else(active=t)?Crafty.mouseObjs++:Crafty.mouseObjs=Math.max(0,Crafty.mouseObjs-1)}),_clamp:function(){if(this.clampToEntities){var t=this.bounds||Crafty.map.boundaries();t.max.x*=this._zoom,t.min.x*=this._zoom,t.max.y*=this._zoom,t.min.y*=this._zoom,t.max.x-t.min.x>Crafty.viewport.width?(t.max.x-=Crafty.viewport.width,Crafty.viewport.x<-t.max.x?Crafty.viewport.x=-t.max.x:Crafty.viewport.x>-t.min.x&&(Crafty.viewport.x=-t.min.x)):Crafty.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-Crafty.viewport.width/2),t.max.y-t.min.y>Crafty.viewport.height?(t.max.y-=Crafty.viewport.height,Crafty.viewport.y<-t.max.y?Crafty.viewport.y=-t.max.y:Crafty.viewport.y>-t.min.y&&(Crafty.viewport.y=-t.min.y)):Crafty.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-Crafty.viewport.height/2)}},init:function(t,e,i){var r;if(Crafty.DOM.window.init(),this.width=!t||Crafty.mobile?Crafty.DOM.window.width:t,this.height=!e||Crafty.mobile?Crafty.DOM.window.height:e,void 0===i&&(i="cr-stage"),"string"==typeof i)r=document.getElementById(i);else{if(!("undefined"!=typeof HTMLElement?i instanceof HTMLElement:i instanceof Element))throw new TypeError("stage_elem must be a string or an HTMLElement");r=i}Crafty.stage={x:0,y:0,fullscreen:!1,elem:r||document.createElement("div"),inner:document.createElement("div")},(!t&&!e||Crafty.mobile)&&(document.body.style.overflow="hidden",Crafty.stage.fullscreen=!0),Crafty.addEvent(this,window,"resize",Crafty.viewport.reload),Crafty.addEvent(this,window,"blur",function(){Crafty.settings.get("autoPause")&&(Crafty._paused||Crafty.pause())}),Crafty.addEvent(this,window,"focus",function(){Crafty._paused&&Crafty.settings.get("autoPause")&&Crafty.pause()}),Crafty.settings.register("stageSelectable",function(t){Crafty.stage.elem.onselectstart=t?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageSelectable",!1),Crafty.settings.register("stageContextMenu",function(t){Crafty.stage.elem.oncontextmenu=t?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageContextMenu",!1),Crafty.settings.register("autoPause",function(){}),Crafty.settings.modify("autoPause",!1),r||(document.body.appendChild(Crafty.stage.elem),Crafty.stage.elem.id=i);var n,s=Crafty.stage.elem.style;if(Crafty.stage.elem.appendChild(Crafty.stage.inner),Crafty.stage.inner.style.position="absolute",Crafty.stage.inner.style.zIndex="1",s.width=this.width+"px",s.height=this.height+"px",s.overflow="hidden",Crafty.mobile){s.position="absolute",s.left="0px",s.top="0px",null!=typeof s.webkitTapHighlightColor&&(s.webkitTapHighlightColor="rgba(0,0,0,0)");var a=document.createElement("meta"),o=document.getElementsByTagName("HEAD")[0];a.setAttribute("name","viewport"),a.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),o.appendChild(a),(a=document.createElement("meta")).setAttribute("name","apple-mobile-web-app-capable"),a.setAttribute("content","yes"),o.appendChild(a),setTimeout(function(){window.scrollTo(0,1)},0),Crafty.addEvent(this,window,"touchmove",function(t){t.preventDefault()}),Crafty.stage.x=0,Crafty.stage.y=0}else s.position="relative",n=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=n.x,Crafty.stage.y=n.y;Crafty.support.setter?(this.__defineSetter__("x",function(t){this.scroll("_x",t)}),this.__defineSetter__("y",function(t){this.scroll("_y",t)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y})):Crafty.support.defineProperty?(Object.defineProperty(this,"x",{set:function(t){this.scroll("_x",t)},get:function(){return this._x}}),Object.defineProperty(this,"y",{set:function(t){this.scroll("_y",t)},get:function(){return this._y}})):(this.x=this._x,this.y=this._y,Crafty.e("viewport"))},reload:function(){Crafty.DOM.window.init();var t,e=Crafty.DOM.window.width,i=Crafty.DOM.window.height;Crafty.stage.fullscreen&&(this.width=e,this.height=i,Crafty.stage.elem.style.width=e+"px",Crafty.stage.elem.style.height=i+"px",Crafty.canvas._canvas&&(Crafty.canvas._canvas.width=e,Crafty.canvas._canvas.height=i,Crafty.DrawManager.drawAll())),t=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=t.x,Crafty.stage.y=t.y},reset:function(){Crafty.viewport.pan("reset"),Crafty.viewport.follow(),Crafty.viewport.mouselook("stop"),Crafty.viewport.scale()}},keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}}),Crafty.c("viewport",{init:function(){this.bind("EnterFrame",function(){Crafty.viewport._x!==Crafty.viewport.x&&Crafty.viewport.scroll("_x",Crafty.viewport.x),Crafty.viewport._y!==Crafty.viewport.y&&Crafty.viewport.scroll("_y",Crafty.viewport.y)})}}),Crafty.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(t){var e;window.DeviceOrientationEvent?e={tiltLR:t.gamma,tiltFB:t.beta,dir:t.alpha,motUD:null}:window.OrientationEvent&&(e={tiltLR:90*t.x,tiltFB:-90*t.y,dir:null,motUD:t.z}),Crafty.device._deviceOrientationCallback(e)},_normalizeDeviceMotion:function(t){var e=t.accelerationIncludingGravity,i=e.z>0?1:-1,r={acceleration:e,rawAcceleration:"["+Math.round(e.x)+", "+Math.round(e.y)+", "+Math.round(e.z)+"]",facingUp:i,tiltLR:Math.round(e.x/9.81*-90),tiltFB:Math.round((e.y+9.81)/9.81*90*i)};Crafty.device._deviceMotionCallback(r)},deviceOrientation:function(t){this._deviceOrientationCallback=t,Crafty.support.deviceorientation&&(window.DeviceOrientationEvent?Crafty.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&Crafty.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(t){this._deviceMotionCallback=t,Crafty.support.devicemotion&&window.DeviceMotionEvent&&Crafty.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}}),Crafty.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var t=function(t){var e=t.co,i=t.pos,r=t.ctx;"canvas"===t.type?r.drawImage(this.img,e.x,e.y,e.w,e.h,i._x,i._y,i._w,i._h):"DOM"===t.type&&(this._element.style.background="url('"+this.__image+"') no-repeat -"+e.x+"px -"+e.y+"px")};this.bind("Draw",t).bind("RemoveComponent",function(e){"Sprite"===e&&this.unbind("Draw",t)})},sprite:function(t,e,i,r){return this.__coord=[t*this.__tile+this.__padding[0]+this.__trim[0],e*this.__tileh+this.__padding[1]+this.__trim[1],this.__trim[2]||i*this.__tile||this.__tile,this.__trim[3]||r*this.__tileh||this.__tileh],this.trigger("Change"),this},crop:function(t,e,i,r){var n=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=t,this.__trim[1]=e,this.__trim[2]=i,this.__trim[3]=r,this.__coord[0]+=t,this.__coord[1]+=e,this.__coord[2]=i,this.__coord[3]=r,this._w=i,this._h=r,this.trigger("Change",n),this}}),Crafty.c("Canvas",{init:function(){Crafty.canvas.context||Crafty.canvas.init(),Crafty.DrawManager.total2D++,this.currentRect={},this._changed=!0,Crafty.DrawManager.addCanvas(this),this.bind("Change",function(t){!1===this._changed&&(this._changed=!0,Crafty.DrawManager.addCanvas(this))}),this.bind("Remove",function(){Crafty.DrawManager.total2D--,this._changed=!0,Crafty.DrawManager.addCanvas(this)})},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,e,i,r,n){if(this.ready){4===arguments.length&&(n=r,r=i,i=e,e=t,t=Crafty.canvas.context);var s=this.drawVars.pos;s._x=this._x+(e||0),s._y=this._y+(i||0),s._w=r||this._w,s._h=n||this._h,context=t||Crafty.canvas.context,coord=this.__coord||[0,0,0,0];var a=this.drawVars.co;if(a.x=coord[0]+(e||0),a.y=coord[1]+(i||0),a.w=r||coord[2],a.h=n||coord[3],this._mbr&&(context.save(),context.translate(this._origin.x+this._x,this._origin.y+this._y),s._x=-this._origin.x,s._y=-this._origin.y,context.rotate(this._rotation%360*(Math.PI/180))),(this._flipX||this._flipY)&&(context.save(),context.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(s._x=-(s._x+s._w)),this._flipY&&(s._y=-(s._y+s._h))),this._alpha<1){var o=context.globalAlpha;context.globalAlpha=this._alpha}return this.drawVars.ctx=context,this.trigger("Draw",this.drawVars),(this._mbr||this._flipX||this._flipY)&&context.restore(),o&&(context.globalAlpha=o),this}}}),Crafty.extend({canvas:{context:null,init:function(){if(!Crafty.support.canvas)return Crafty.trigger("NoCanvas"),void Crafty.stop();var t;(t=document.createElement("canvas")).width=Crafty.viewport.width,t.height=Crafty.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",Crafty.stage.elem.appendChild(t),Crafty.canvas.context=t.getContext("2d"),Crafty.canvas._canvas=t;var e=Crafty.viewport._zoom;1!=e&&Crafty.canvas.context.scale(e,e)}}}),Crafty.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(t){var e=t.clientX>Crafty.stage.x&&t.clientX<Crafty.stage.x+Crafty.viewport.width&&t.clientY>Crafty.stage.y&&t.clientY<Crafty.stage.y+Crafty.viewport.height;!Crafty.selected&&e&&Crafty.trigger("CraftyFocus"),Crafty.selected&&!e&&Crafty.trigger("CraftyBlur"),Crafty.selected=e},mouseDispatch:function(t){if(Crafty.mouseObjs){Crafty.lastEvent=t;var e,i,r,n,s,a=-1,o=0,h=Crafty.DOM.translate(t.clientX,t.clientY),u={},f=t.target?t.target:t.srcElement,c=t.type;if(null==t.which?t.mouseButton=t.button<2?Crafty.mouseButtons.LEFT:4==t.button?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT:t.mouseButton=t.which<2?Crafty.mouseButtons.LEFT:2==t.which?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT,t.realX=n=Crafty.mousePos.x=h.x,t.realY=s=Crafty.mousePos.y=h.y,"CANVAS"!=f.nodeName){for(;"string"!=typeof f.id&&-1==f.id.indexOf("ent");)f=f.parentNode;ent=Crafty(parseInt(f.id.replace("ent",""))),ent.has("Mouse")&&ent.isAt(n,s)&&(e=ent)}if(!e)for(r=(i=Crafty.map.search({_x:n,_y:s,_w:1,_h:1},!1)).length;o<r;++o)if(i[o].__c.Mouse&&i[o]._visible){var l=i[o],d=!1;if(!u[l[0]]&&(u[l[0]]=!0,l.mapArea?l.mapArea.containsPoint(n,s)&&(d=!0):l.isAt(n,s)&&(d=!0),d&&(l._z>=a||-1===a))){if(l._z===a&&l[0]<e[0])continue;a=l._z,e=l}}e?"mousedown"===c?e.trigger("MouseDown",t):"mouseup"===c?e.trigger("MouseUp",t):"dblclick"==c?e.trigger("DoubleClick",t):"click"==c?e.trigger("Click",t):"mousemove"===c?(e.trigger("MouseMove",t),this.over!==e&&(this.over&&(this.over.trigger("MouseOut",t),this.over=null),this.over=e,e.trigger("MouseOver",t))):e.trigger(c,t):("mousemove"===c&&this.over&&(this.over.trigger("MouseOut",t),this.over=null),"mousedown"===c?Crafty.viewport.mouselook("start",t):"mousemove"===c?Crafty.viewport.mouselook("drag",t):"mouseup"==c&&Crafty.viewport.mouselook("stop")),"mousemove"===c&&(this.lastEvent=t)}},touchDispatch:function(t){var e,i,r=Crafty.lastEvent;("touchstart"===t.type?e="mousedown":"touchmove"===t.type?e="mousemove":"touchend"===t.type?e="mouseup":"touchcancel"===t.type?e="mouseup":"touchleave"===t.type&&(e="mouseup"),t.touches&&t.touches.length?first=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(first=t.changedTouches[0]),(i=document.createEvent("MouseEvent")).initMouseEvent(e,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(i),null!=r&&"mousedown"==r.type&&"mouseup"==e)&&(e="click",(i=document.createEvent("MouseEvent")).initMouseEvent(e,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(i));t.preventDefault?t.preventDefault():t.returnValue=!1},keyboardDispatch:function(t){for(var e=t,i={},r="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" "),n=r.length;n;){var s=r[--n];i[s]=e[s]}if(i.which=null!=e.charCode?e.charCode:e.keyCode,i.key=e.keyCode||e.which,i.originalEvent=e,"keydown"===(t=i).type?!0!==Crafty.keydown[t.key]&&(Crafty.keydown[t.key]=!0,Crafty.trigger("KeyDown",t)):"keyup"===t.type&&(delete Crafty.keydown[t.key],Crafty.trigger("KeyUp",t)),Crafty.selected&&!(8==t.key||t.key>=112&&t.key<=135))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(t.preventDefault?t.preventDefault():t.returnValue=!1),!1}}),Crafty.bind("Load",function(){Crafty.addEvent(this,"keydown",Crafty.keyboardDispatch),Crafty.addEvent(this,"keyup",Crafty.keyboardDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch),Crafty.addEvent(this,document.body,"mouseup",Crafty.detectBlur),Crafty.addEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"click",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"dblclick",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchstart",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchmove",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchend",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchcancel",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchleave",Crafty.touchDispatch)}),Crafty.bind("CraftyStop",function(){Crafty.removeEvent(this,"keydown",Crafty.keyboardDispatch),Crafty.removeEvent(this,"keyup",Crafty.keyboardDispatch),Crafty.stage&&(Crafty.removeEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"click",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"dblclick",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchstart",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchmove",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchend",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchcancel",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchleave",Crafty.touchDispatch)),Crafty.removeEvent(this,document.body,"mouseup",Crafty.detectBlur)}),Crafty.c("Mouse",{init:function(){Crafty.mouseObjs++,this.bind("Remove",function(){Crafty.mouseObjs--})},areaMap:function(t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new Crafty.polygon(e)}return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this}}),Crafty.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,_ondrag:null,_ondown:null,_onup:null,init:function(){this.requires("Mouse"),this._ondrag=function(t){var e=Crafty.DOM.translate(t.clientX,t.clientY);if(0==e.x||0==e.y)return!1;if(this._dir){var i=(e.x-this._origMouseDOMPos.x)*this._dir.x+(e.y-this._origMouseDOMPos.y)*this._dir.y;this.x=this._oldX+i*this._dir.x,this.y=this._oldY+i*this._dir.y}else this.x=this._oldX+(e.x-this._origMouseDOMPos.x),this.y=this._oldY+(e.y-this._origMouseDOMPos.y);this.trigger("Dragging",t)},this._ondown=function(t){t.mouseButton===Crafty.mouseButtons.LEFT&&this._startDrag(t)},this._onup=function(t){1==this._dragging&&(Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",t))},this.enableDrag()},dragDirection:function(t){if(void 0===t)this._dir=null;else if(""+parseInt(t)==t)this._dir={x:Math.cos(t/180*Math.PI),y:Math.sin(t/180*Math.PI)};else{var e=Math.sqrt(t.x*t.x+t.y*t.y);this._dir={x:t.x/e,y:t.y/e}}},_startDrag:function(t){this._origMouseDOMPos=Crafty.DOM.translate(t.clientX,t.clientY),this._oldX=this._x,this._oldY=this._y,this._dragging=!0,Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",t)},stopDrag:function(){return Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag"),this},startDrag:function(){return this._dragging||this._startDrag(Crafty.lastEvent),this},enableDrag:function(){return this.bind("MouseDown",this._ondown),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this},disableDrag:function(){return this.unbind("MouseDown",this._ondown),this._dragging&&this.stopDrag(),this}}),Crafty.c("Keyboard",{isDown:function(t){return"string"==typeof t&&(t=Crafty.keys[t]),!!Crafty.keydown[t]}}),Crafty.c("Multiway",{_speed:3,_keydown:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x+this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y+this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_keyup:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x-this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y-this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_enterframe:function(){this.disableControls||(0!==this._movement.x&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),0!==this._movement.y&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y})))},multiway:function(t,e){for(var i in this._keyDirection={},this._keys={},this._movement={x:0,y:0},this._speed={x:3,y:3},e?t.x&&t.y?(this._speed.x=t.x,this._speed.y=t.y):(this._speed.x=t,this._speed.y=t):e=t,this._keyDirection=e,this.speed(this._speed),this.disableControl(),this.enableControl(),e)Crafty.keydown[Crafty.keys[i]]&&this.trigger("KeyDown",{key:Crafty.keys[i]});return this},enableControl:function(){return this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe),this},disableControl:function(){return this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe),this},speed:function(t){for(var e in this._keyDirection){var i=Crafty.keys[e]||e;this._keys[i]={x:Math.round(1e3*Math.cos(this._keyDirection[e]*(Math.PI/180))*t.x)/1e3,y:Math.round(1e3*Math.sin(this._keyDirection[e]*(Math.PI/180))*t.y)/1e3}}return this}}),Crafty.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(t){return this.multiway(t,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),Crafty.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard")},twoway:function(t,e){return this.multiway(t,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),t&&(this._speed=t),arguments.length<2&&(e=2*this._speed),this.bind("EnterFrame",function(){this.disableControls||this._up&&(this.y-=e,this._falling=!0)}).bind("KeyDown",function(){(this.isDown("UP_ARROW")||this.isDown("W")||this.isDown("Z"))&&(this._up=!0)}),this}}),Crafty.c("Animation",{_reel:null,init:function(){this._reel={}},addAnimation:function(t,e){var i,r,n,s,a,o,h,u=0,f=0,c={},l=[];for(i in e){for(a in n=e[i],s=e[u]||this,c={},n)"number"==typeof n[a]?c[a]=(n[a]-s[a])/(i-u):c[a]=n[a];for(f=+u+1,r=1;f<=+i;++f,++r){for(o in h={},c)"number"==typeof c[o]?h[o]=s[o]+c[o]*r:h[o]=c[o];l[f]=h}u=i}return this._reel[t]=l,this},playAnimation:function(t){var e,i=this._reel[t],r=0,n=i.length;this.bind("EnterFrame",function t(){for(e in i[r])this[e]=i[r][e];++r>n&&(this.trigger("AnimationEnd"),this.unbind("EnterFrame",t))})}}),Crafty.c("SpriteAnimation",{_reels:null,_frame:null,_currentReelId:null,init:function(){this._reels={}},animate:function(t,e,i,r){var n,s,a,o,h,u;if(arguments.length<4&&"number"==typeof e)return h=e,this._currentReelId=t,currentReel=this._reels[t],this._frame={currentReel:currentReel,numberOfFramesBetweenSlides:Math.ceil(h/currentReel.length),currentSlideNumber:0,frameNumberBetweenSlides:0,repeat:0},3===arguments.length&&"number"==typeof i&&(-1===i?this._frame.repeatInfinitly=!0:this._frame.repeat=i),u=this._frame.currentReel[0],this.__coord[0]=u[0],this.__coord[1]=u[1],this.bind("EnterFrame",this.updateSprite),this;if("number"==typeof e){if(a=this.__tile+parseInt(this.__padding[0]||0,10),o=this.__tileh+parseInt(this.__padding[1]||0,10),n=[],s=e,r>e)for(;s<=r;s++)n.push([s*a,i*o]);else for(;s>=r;s--)n.push([s*a,i*o]);this._reels[t]=n}else if("object"==typeof e){for(s=0,n=[],r=e.length-1,a=this.__tile+parseInt(this.__padding[0]||0,10),o=this.__tileh+parseInt(this.__padding[1]||0,10);s<=r;s++)u=e[s],n.push([u[0]*a,u[1]*o]);this._reels[t]=n}return this},updateSprite:function(){var t=this._frame;if(t){if(this._frame.frameNumberBetweenSlides++===t.numberOfFramesBetweenSlides){var e=t.currentReel[t.currentSlideNumber++];this.__coord[0]=e[0],this.__coord[1]=e[1],this._frame.frameNumberBetweenSlides=0}if(t.currentSlideNumber===t.currentReel.length)if(!0===this._frame.repeatInfinitly||this._frame.repeat>0)this._frame.repeat&&this._frame.repeat--,this._frame.frameNumberBetweenSlides=0,this._frame.currentSlideNumber=0;else if(this._frame.frameNumberBetweenSlides===t.numberOfFramesBetweenSlides)return this.trigger("AnimationEnd",{reel:t.currentReel}),void this.stop();this.trigger("Change")}},stop:function(){return this.unbind("EnterFrame",this.updateSprite),this.unbind("AnimationEnd"),this._currentReelId=null,this._frame=null,this},reset:function(){if(!this._frame)return this;var t=this._frame.currentReel[0];return this.__coord[0]=t[0],this.__coord[1]=t[1],this.stop(),this},isPlaying:function(t){return t?this._currentReelId===t:!!this._currentReelId}}),Crafty.c("Tween",{_step:null,_numProps:0,tween:function(t,e){return this.each(function(){for(var i in null==this._step&&(this._step={},this.bind("EnterFrame",tweenEnterFrame),this.bind("RemoveComponent",function(t){"Tween"==t&&this.unbind("EnterFrame",tweenEnterFrame)})),t)this._step[i]={prop:t[i],val:(t[i]-this[i])/e,rem:e},this._numProps++}),this}}),Crafty.c("Color",{_color:"",ready:!0,init:function(){this.bind("Draw",function(t){"DOM"===t.type?(t.style.background=this._color,t.style.lineHeight=0):"canvas"===t.type&&(this._color&&(t.ctx.fillStyle=this._color),t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h))})},color:function(t){return t?(this._color=t,this.trigger("Change"),this):this._color}}),Crafty.c("Tint",{_color:null,_strength:1,init:function(){var t=function(t){var e=t.ctx||Crafty.canvas.context;e.fillStyle=this._color||"rgba(0,0,0, 0)",e.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)};this.bind("Draw",t).bind("RemoveComponent",function(e){"Tint"===e&&this.unbind("Draw",t)})},tint:function(t,e){return this._strength=e,this._color=Crafty.toRGB(t,this._strength),this.trigger("Change"),this}}),Crafty.c("Image",{_repeat:"repeat",ready:!1,init:function(){var t=function(t){if("canvas"===t.type){if(!this.ready||!this._pattern)return;var e=t.ctx;e.fillStyle=this._pattern,e.save(),e.translate(t.pos._x,t.pos._y),e.fillRect(0,0,this._w,this._h),e.restore()}else"DOM"===t.type&&this.__image&&(t.style.background="url("+this.__image+") "+this._repeat)};this.bind("Draw",t).bind("RemoveComponent",function(e){"Image"===e&&this.unbind("Draw",t)})},image:function(t,e){if(this.__image=t,this._repeat=e||"no-repeat",this.img=Crafty.asset(t),!this.img){this.img=new Image,Crafty.asset(t,this.img),this.img.src=t;var i=this;return this.img.onload=function(){i.has("Canvas")&&(i._pattern=Crafty.canvas.context.createPattern(i.img,i._repeat)),i.ready=!0,"no-repeat"===i._repeat&&(i.w=i.img.width,i.h=i.img.height),i.trigger("Change")},this}return this.ready=!0,this.has("Canvas")&&(this._pattern=Crafty.canvas.context.createPattern(this.img,this._repeat)),"no-repeat"===this._repeat&&(this.w=this.img.width,this.h=this.img.height),this.trigger("Change"),this}}),Crafty.extend({_scenes:{},_current:null,scene:function(t,e,i){if(1===arguments.length){Crafty.viewport.reset(),Crafty("2D").each(function(){this.has("Persist")||this.destroy()}),null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this),this._scenes[t].initialize.call(this);var r=this._current;return this._current=t,void Crafty.trigger("SceneChange",{oldScene:r,newScene:t})}this._scenes[t]={},this._scenes[t].initialize=e,void 0!==i&&(this._scenes[t].uninitialize=i)},toRGB:function(t,e){t="#"===t.charAt(0)?t.substr(1):t;var i=[];return i[0]=parseInt(t.substr(0,2),16),i[1]=parseInt(t.substr(2,2),16),i[2]=parseInt(t.substr(4,2),16),void 0===e?"rgb("+i.join(",")+")":"rgba("+i.join(",")+","+e+")"}}),Crafty.DrawManager=function(){function t(t,e){return t._globalZ-e._globalZ}var e=[],i=[],r=[],n={merge:function(t,e,i){return null==i&&(i={}),i._h=Math.max(t._y+t._h,e._y+e._h),i._w=Math.max(t._x+t._w,e._x+e._w),i._x=~~Math.min(t._x,e._x),i._y=~~Math.min(t._y,e._y),i._w-=i._x,i._h-=i._y,i._w=i._w==~~i._w?i._w:1+~~i._w|0,i._h=i._h==~~i._h?i._h:1+~~i._h|0,i},clean:function(){var t,r,n;for(n=0,l=i.length;n<l;n++)t=(r=i[n])._mbr||r,null==r.staleRect&&(r.staleRect={}),r.staleRect._x=t._x,r.staleRect._y=t._y,r.staleRect._w=t._w,r.staleRect._h=t._h,r._changed=!1;i.length=0,e.length=0},createDirty:function(t){var i=t._mbr||t;if(t.staleRect){if(n.overlap(t.staleRect,i))return n.merge(t.staleRect,i,t.staleRect),void e.push(t.staleRect);e.push(t.staleRect)}t.currentRect._x=i._x,t.currentRect._y=i._y,t.currentRect._w=i._w,t.currentRect._h=i._h,e.push(t.currentRect)},overlap:function(t,e){return t._x<e._x+e._w&&t._y<e._y+e._h&&t._x+t._w>e._x&&t._y+t._h>e._y}};return{total2D:Crafty("2D").length,onScreen:function(t){return Crafty.viewport._x+t._x+t._w>0&&Crafty.viewport._y+t._y+t._h>0&&Crafty.viewport._x+t._x<Crafty.viewport.width&&Crafty.viewport._y+t._y<Crafty.viewport.height},mergeSet:function(t){for(var e=0;e<t.length-1;)n.overlap(t[e],t[e+1])?(n.merge(t[e],t[e+1],t[e]),t.splice(e+1,1),e>0&&e--):e++;return t},addCanvas:function(t){i.push(t)},addDom:function(t){r.push(t)},debug:function(){console.log(i,r)},drawAll:function(e){e=e||Crafty.viewport.rect();var i,r=Crafty.map.search(e),n=0,s=r.length;for(Crafty.canvas.context.clearRect(e._x,e._y,e._w,e._h),r.sort(t);n<s;n++)(i=r[n])._visible&&i.__c.Canvas&&(i.draw(),i._changed=!1)},boundingRect:function(t){if(t&&t.length){var e,i,r=1,n=t.length,s=t[0];for(s=[s._x,s._y,s._x+s._w,s._y+s._h];r<n;)(i=[(e=t[r])._x,e._y,e._x+e._w,e._y+e._h])[0]<s[0]&&(s[0]=i[0]),i[1]<s[1]&&(s[1]=i[1]),i[2]>s[2]&&(s[2]=i[2]),i[3]>s[3]&&(s[3]=i[3]),r++;return s={_x:(i=s)[0],_y:i[1],_w:i[2]-i[0],_h:i[3]-i[1]}}},draw:function(){if(i.length||r.length){for(var s,a,o,h,u,f=0,c=i.length,l=r.length,d=Crafty.canvas.context;f<l;++f)r[f].draw()._changed=!1;if(r.length=0,c){if(c/this.total2D>.6)return this.drawAll(),void n.clean();for(f=0;f<c;f++)n.createDirty(i[f]);c=(e=this.mergeSet(e)).length;var y=[],p=[];for(f=0;f<c;++f)if(s=e[f],y.length=0,p.length=0,s){for(a=Crafty.map.search(s,!1),d.clearRect(s._x,s._y,s._w,s._h),d.save(),d.beginPath(),d.rect(s._x,s._y,s._w,s._h),d.clip(),o=0,h=a.length;o<h;++o)!y[(u=a[o])[0]]&&u._visible&&u.__c.Canvas&&(y[u[0]]=!0,p.push(u));for(p.sort(t),o=0,h=p.length;o<h;++o){var _=(u=p[o])._mbr||u;n.overlap(_,s)&&u.draw(),u._changed=!1}d.closePath(),d.restore()}if(!0===Crafty.DrawManager.debugDirty)for(d.strokeStyle="red",f=0,c=e.length;f<c;++f)s=e[f],d.strokeRect(s._x,s._y,s._w,s._h);n.clean()}}}}}(),Crafty.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,e){return this._tile.width=t,this._tile.height=e>0?e:t/2,this},place:function(t,e,i,r){var n=this.pos2px(t,e);return n.top-=i*(this._tile.width/2),r.attr({x:n.left+Crafty.viewport._x,y:n.top+Crafty.viewport._y}).z+=i,this},pos2px:function(t,e){return{left:t*this._tile.width+(1&e)*(this._tile.width/2),top:e*this._tile.height/2}},px2pos:function(t,e){return{x:Math.ceil(-t/this._tile.width-.5*(1&e)),y:-e/this._tile.height*2}},centerAt:function(t,e){if("number"==typeof t&&"number"==typeof e){var i=this.pos2px(t,e);return Crafty.viewport._x=-i.left+Crafty.viewport.width/2-this._tile.width/2,Crafty.viewport._y=-i.top+Crafty.viewport.height/2-this._tile.height/2,this}return{top:-Crafty.viewport._y+Crafty.viewport.height/2-this._tile.height/2,left:-Crafty.viewport._x+Crafty.viewport.width/2-this._tile.width/2}},area:function(){var t=this.centerAt(),e=this.px2pos(-t.left+Crafty.viewport.width/2,-t.top+Crafty.viewport.height/2),i=this.px2pos(-t.left-Crafty.viewport.width/2,-t.top-Crafty.viewport.height/2);return{x:{start:e.x,end:i.x},y:{start:e.y,end:i.y}}}}}),Crafty.c("Particles",{init:function(){this._Particles=Crafty.clone(this._Particles)},particles:function(t){if(!Crafty.support.canvas||Crafty.deactivateParticles)return this;var e,i,r,n,s;(e=document.createElement("canvas")).width=Crafty.viewport.width,e.height=Crafty.viewport.height,e.style.position="absolute",Crafty.stage.elem.appendChild(e),i=e.getContext("2d"),this._Particles.init(t),this.bind("Remove",function(){Crafty.stage.elem.removeChild(e)}).bind("RemoveComponent",function(t){"particles"===t&&Crafty.stage.elem.removeChild(e)}),r=this.x+Crafty.viewport.x,n=this.y+Crafty.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(r,n);var a={x:Crafty.viewport.x,y:Crafty.viewport.y};return this.bind("EnterFrame",function(){r=this.x+Crafty.viewport.x,n=this.y+Crafty.viewport.y,this._Particles.viewportDelta={x:Crafty.viewport.x-a.x,y:Crafty.viewport.y-a.y},a={x:Crafty.viewport.x,y:Crafty.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(r,n),"function"==typeof Crafty.DrawManager.boundingRect?(s=Crafty.DrawManager.boundingRect(this._Particles.register))&&i.clearRect(s._x,s._y,s._w,s._h):i.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),this._Particles.update(),this._Particles.render(i)}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(t){if(this.position=this.vectorHelpers.create(0,0),void 0===t)t={};for(key in this.presets)void 0!==t[key]?this[key]=t[key]:this[key]=this.presets[key];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var t=new this.particle(this.vectorHelpers);return this.initParticle(t),this.particles[this.particleCount]=t,this.particleCount++,!0},RANDM1TO1:function(){return 2*Math.random()-1},initParticle:function(t){t.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1(),t.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),i=this.vectorHelpers.create(Math.sin(e),-Math.cos(e)),r=this.speed+this.speedRandom*this.RANDM1TO1();t.direction=this.vectorHelpers.multiply(i,r),t.size=this.size+this.sizeRandom*this.RANDM1TO1(),t.size=t.size<0?0:~~t.size,t.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),t.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),t.sharpness=t.sharpness>100?100:t.sharpness<0?0:t.sharpness,t.sizeSmall=~~(t.size/200*t.sharpness);var n=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],s=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];t.colour=n,t.deltaColour[0]=(s[0]-n[0])/t.timeToLive,t.deltaColour[1]=(s[1]-n[1])/t.timeToLive,t.deltaColour[2]=(s[2]-n[2])/t.timeToLive,t.deltaColour[3]=(s[3]-n[3])/t.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var t=1/this.emissionRate;for(this.emitCounter++;this.particleCount<this.maxParticles&&this.emitCounter>t;)this.addParticle(),this.emitCounter-=t;this.elapsedFrames++,-1!=this.duration&&this.duration<this.elapsedFrames&&this.stop()}var e;for(this.particleIndex=0,this.register=[];this.particleIndex<this.particleCount;){var i=this.particles[this.particleIndex];if(i.timeToLive>0){i.direction=this.vectorHelpers.add(i.direction,this.gravity),i.position=this.vectorHelpers.add(i.position,i.direction),i.position=this.vectorHelpers.add(i.position,this.viewportDelta),this.jitter&&(i.position.x+=this.jitter*this.RANDM1TO1(),i.position.y+=this.jitter*this.RANDM1TO1()),i.timeToLive--;var r=i.colour[0]+=i.deltaColour[0],n=i.colour[1]+=i.deltaColour[1],s=i.colour[2]+=i.deltaColour[2],a=i.colour[3]+=i.deltaColour[3];(e=[]).push("rgba("+(r>255?255:r<0?0:~~r)),e.push(n>255?255:n<0?0:~~n),e.push(s>255?255:s<0?0:~~s),e.push((a>1?1:a<0?0:a.toFixed(2))+")"),i.drawColour=e.join(","),this.fastMode||(e[3]="0)",i.drawColourEnd=e.join(",")),this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var o={};o._x=~~i.position.x,o._y=~~i.position.y,o._w=i.size,o._h=i.size,this.register.push(o)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0},render:function(t){for(var e=0,i=this.particleCount;e<i;e++){var r=this.particles[e],n=r.size,s=n>>1;if(!(r.position.x+n<0||r.position.y+n<0||r.position.x-n>Crafty.viewport.width||r.position.y-n>Crafty.viewport.height)){var a=~~r.position.x,o=~~r.position.y;if(this.fastMode)t.fillStyle=r.drawColour;else{var h=t.createRadialGradient(a+s,o+s,r.sizeSmall,a+s,o+s,s);h.addColorStop(0,r.drawColour),h.addColorStop(.9,r.drawColourEnd),t.fillStyle=h}t.fillRect(a,o,n,n)}}},particle:function(t){this.position=t.create(0,0),this.direction=t.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(t,e){return{x:t,y:e}},multiply:function(t,e){return t.x*=e,t.y*=e,t},add:function(t,e){return t.x+=e.x,t.y+=e.y,t}}}}),Crafty.extend({audio:{sounds:{},supported:{},codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,canPlay:function(){var t,e=this.audioElement();for(var i in this.codecs)t=e.canPlayType(this.codecs[i]),this.supported[i]=""!==t&&"no"!==t},audioElement:function(){return"undefined"!=typeof Audio?new Audio(""):document.createElement("audio")},add:function(t,e){if(Crafty.support.audio=!!this.audioElement().canPlayType,Crafty.support.audio){var i,r,n;if(this.canPlay(),1===arguments.length&&"object"==typeof t)for(var s in t)for(var a in t[s])(i=this.audioElement()).id=s,i.preload="auto",i.volume=Crafty.audio.volume,r=(n=t[s][a]).substr(n.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(i.src=n,Crafty.asset(n,i),this.sounds[s]={obj:i,played:0,volume:Crafty.audio.volume});if("string"==typeof t&&((i=this.audioElement()).id=t,i.preload="auto",i.volume=Crafty.audio.volume,"string"==typeof e&&(r=e.substr(e.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(i.src=e,Crafty.asset(e,i),this.sounds[t]={obj:i,played:0,volume:Crafty.audio.volume})),"object"==typeof e))for(a in e)(i=this.audioElement()).id=t,i.preload="auto",i.volume=Crafty.audio.volume,r=(n=e[a]).substr(n.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(i.src=n,Crafty.asset(n,i),this.sounds[t]={obj:i,played:0,volume:Crafty.audio.volume})}},play:function(t,e,i){if(0!=e&&Crafty.support.audio&&this.sounds[t]){var r=this.sounds[t];r.volume=r.obj.volume=i||Crafty.audio.volume,r.obj.currentTime&&(r.obj.currentTime=0),this.muted&&(r.obj.volume=0),r.obj.play(),r.played++,r.obj.addEventListener("ended",function(){(r.played<e||-1==e)&&(this.currentTime&&(this.currentTime=0),this.play(),r.played++)},!0)}},remove:function(t){var e;if(Crafty.support.audio)if(t)this.sounds[t]&&(e=this.sounds[t],Crafty.audio.stop(t),delete Crafty.assets[e.obj.src],delete Crafty.audio.sounds[t]);else for(var i in this.sounds)e=this.sounds[i],Crafty.audio.stop(t),delete Crafty.assets[e.obj.src],delete Crafty.audio.sounds[t]},stop:function(t){if(Crafty.support.audio){var e;if(!t)for(var i in this.sounds)(e=this.sounds[i]).obj.paused||e.obj.pause();this.sounds[t]&&((e=this.sounds[t]).obj.paused||e.obj.pause())}},_mute:function(t){if(Crafty.support.audio){var e;for(var i in this.sounds)(e=this.sounds[i]).obj.volume=t?0:e.volume;this.muted=t}},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(t){if(Crafty.support.audio&&t&&this.sounds[t]){var e=this.sounds[t];e.obj.paused||e.obj.pause()}},unpause:function(t){if(Crafty.support.audio&&t&&this.sounds[t]){var e=this.sounds[t];e.obj.paused&&e.obj.play()}},togglePause:function(t){if(Crafty.support.audio&&t&&this.sounds[t]){var e=this.sounds[t];e.obj.paused?e.obj.play():e.obj.pause()}}}}),Crafty.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",ready:!0,init:function(){this.requires("2D"),this._textFont={type:"",weight:"",size:"",family:""},this.bind("Draw",function(t){var e=this._textFont.type+" "+this._textFont.weight+" "+(this._textFont.size||this.defaultSize)+" "+(this._textFont.family||this.defaultFamily);if("DOM"===t.type){var i=this._element,r=i.style;r.color=this._textColor,r.font=e,i.innerHTML=this._text}else if("canvas"===t.type){var n,s=t.ctx;s.save(),s.fillStyle=this._textColor||"rgb(0,0,0)",s.font=e,s.translate(this.x,this.y+this.h),s.fillText(this._text,0,0),n=s.measureText(this._text),this._w=n.width,s.restore()}})},text:function(t){return null==t?this._text:(this._text="function"==typeof t?t.call(this):t,this.trigger("Change"),this)},textColor:function(t,e){return this._strength=e,this._textColor=Crafty.toRGB(t,this._strength),this.trigger("Change"),this},textFont:function(t,e){if(1===arguments.length){if("string"==typeof t)return this._textFont[t];if("object"==typeof t)for(propertyKey in t)this._textFont[propertyKey]=t[propertyKey]}else this._textFont[t]=e;return this.trigger("Change"),this},unselectable:function(){return this.has("DOM")&&(this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),this.trigger("Change")),this}}),Crafty.extend({assets:{},asset:function(t,e){if(1===arguments.length)return Crafty.assets[t];Crafty.assets[t]||(Crafty.assets[t]=e,this.trigger("NewAsset",{key:t,value:e}))},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(t,e,i,r){var n,s,a=0,o=t.length,h=o,u=0,f="";function c(){var t=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",c,!1),++u,i&&i({loaded:u,total:h,percent:u/h*100,src:t}),u===h&&e&&e()}function l(){var t=this.src;r&&r({loaded:u,total:h,percent:u/h*100,src:t}),++u===h&&e&&e()}for(;a<o;++a){if(f=(n=t[a]).substr(n.lastIndexOf(".")+1,3).toLowerCase(),s=Crafty.asset(n)||null,Crafty.support.audio&&Crafty.audio.supported[f]){if(!s){var d=n.substr(n.lastIndexOf("/")+1).toLowerCase();(s=Crafty.audio.audioElement()).id=d,s.src=n,s.preload="auto",s.volume=Crafty.audio.volume,Crafty.asset(n,s),Crafty.audio.sounds[d]={obj:s,played:0}}s.addEventListener&&s.addEventListener("canplaythrough",c,!1)}else{if(!(Crafty.image_whitelist.indexOf(f)>=0)){h--;continue}s||(s=new Image,Crafty.asset(n,s)),s.onload=c,s.src="",s.src=n}s.onerror=l}},modules:function(t,e,i){2===arguments.length&&"object"==typeof t&&(i=e,e=t,t="http://cdn.craftycomponents.com")
/*!
		  * $script.js Async loader & dependency manager
		  * https://github.com/ded/script.js
		  * (c) Dustin Diaz, Jacob Thornton 2011
		  * License: MIT
		  */;var r=function(){var t,e=this,i=document,r=i.getElementsByTagName("head")[0],n=/^https?:\/\//,s=e.$script,a={},o={},h={},u={},f=!1,c="push",l="readyState",d="onreadystatechange";function y(t,e,i){for(i=0,j=t.length;i<j;++i)if(!e(t[i]))return f;return 1}function p(t,e){y(t,function(t){return!e(t)})}function _(e,i,r){e=e[c]?e:[e];var s=i&&i.call,f=s?i:r,l=s?e.join(""):i,d=e.length;function g(t){return t.call?t():a[t]}function v(){if(!--d)for(var t in a[l]=1,f&&f(),h)y(t.split("|"),g)&&!p(h[t],g)&&(h[t]=[])}return setTimeout(function(){p(e,function(e){if(u[e])return l&&(o[l]=1),2==u[e]&&v();u[e]=1,l&&(o[l]=1),m(!n.test(e)&&t?t+e+".js":e,v)})},0),_}function m(t,e){var n=i.createElement("script"),s=f;n.onload=n.onerror=n[d]=function(){n[l]&&!/^c|loade/.test(n[l])||s||(n.onload=n[d]=null,s=1,u[t]=2,e())},n.async=1,n.src=t,r.insertBefore(n,r.firstChild)}return!i[l]&&i.addEventListener&&(i.addEventListener("DOMContentLoaded",function t(){i.removeEventListener("DOMContentLoaded",t,f),i[l]="complete"},f),i[l]="loading"),_.get=m,_.order=function(t,e,i){!function r(n){n=t.shift(),t.length?_(n,r):_(n,e,i)}()},_.path=function(e){t=e},_.ready=function(t,e,i){t=t[c]?t:[t];var r=[];return!p(t,function(t){a[t]||r[c](t)})&&y(t,function(t){return a[t]})?e():function(t){h[t]=h[t]||[],h[t][c](e),i&&i(r)}(t.join("|")),_},_.noConflict=function(){return e.$script=s,this},_}(),n=[],s=/^(https?|file):\/\//;for(var a in e)s.test(a)?n.push(a):n.push(t+"/"+a.toLowerCase()+"-"+e[a].toLowerCase()+".js");r(n,function(){i&&i()})}}),Crafty.math={abs:function(t){return t<0?-t:t},amountOf:function(t,e,i){return e<i?(t-e)/(i-e):(t-i)/(e-i)},clamp:function(t,e,i){return t>i?i:t<e?e:t},degToRad:function(t){return t*Math.PI/180},distance:function(t,e,i,r){var n=Crafty.math.squaredDistance(t,e,i,r);return Math.sqrt(parseFloat(n))},lerp:function(t,e,i){return t+(e-t)*i},negate:function(t){return Math.random()<t?-1:1},radToDeg:function(t){return 180*t/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,e){return t+Math.floor((1+e-t)*Math.random())},randomNumber:function(t,e){return t+(e-t)*Math.random()},squaredDistance:function(t,e,i,r){return(t-i)*(t-i)+(e-r)*(e-r)},withinRange:function(t,e,i){return t>=e&&t<=i}},Crafty.math.Vector2D=function(){function t(e,i){if(e instanceof t)this.x=e.x,this.y=e.y;else if(2===arguments.length)this.x=e,this.y=i;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return t.prototype.x=0,t.prototype.y=0,t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.clone=function(){return new t(this)},t.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},t.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.equals=function(e){return e instanceof t&&this.x==e.x&&this.y==e.y},t.prototype.getNormal=function(e){return void 0===e?new t(-this.y,this.x):new t(e.y-this.y,this.x-e.x).normalize()},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?(this.x=1,this.y=0):(this.x/=t,this.y/=t),this},t.prototype.scale=function(t,e){return void 0===e&&(e=t),this.x*=t,this.y*=e,this},t.prototype.scaleToMagnitude=function(t){var e=t/this.magnitude();return this.x*=e,this.y*=e,this},t.prototype.setValues=function(e,i){return e instanceof t?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},t.prototype.translate=function(t,e){return void 0===e&&(e=t),this.x+=t,this.y+=e,this},t.tripleProduct=function(t,e,i){var r=t.dotProduct(i),n=e.dotProduct(i);return new Crafty.math.Vector2D(e.x*r-t.x*n,e.y*r-t.y*n)},t}(),Crafty.math.Matrix2D=(Matrix2D=function(t,e,i,r,n,s){if(t instanceof Matrix2D)this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f;else if(6===arguments.length)this.a=t,this.b=e,this.c=i,this.d=r,this.e=n,this.f=s;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"},Matrix2D.prototype.a=1,Matrix2D.prototype.b=0,Matrix2D.prototype.c=0,Matrix2D.prototype.d=1,Matrix2D.prototype.e=0,Matrix2D.prototype.f=0,Matrix2D.prototype.apply=function(t){var e=t.x;return t.x=e*this.a+t.y*this.c+this.e,t.y=e*this.b+t.y*this.d+this.f,t},Matrix2D.prototype.clone=function(){return new Matrix2D(this)},Matrix2D.prototype.combine=function(t){var e=this.a;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,e=this.c,this.c=e*t.a+this.d*t.c,this.d=e*t.b+this.d*t.d,e=this.e,this.e=e*t.a+this.f*t.c+t.e,this.f=e*t.b+this.f*t.d+t.f,this},Matrix2D.prototype.equals=function(t){return t instanceof Matrix2D&&this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.e==t.e&&this.f==t.f},Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c},Matrix2D.prototype.invert=function(){var t=this.determinant();if(0!==t){var e={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=e.d/t,this.b=-e.b/t,this.c=-e.c/t,this.d=e.a/t,this.e=(e.c*e.f-e.e*e.d)/t,this.f=(e.e*e.b-e.a*e.f)/t}return this},Matrix2D.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},Matrix2D.prototype.isInvertible=function(){return 0!==this.determinant()},Matrix2D.prototype.preRotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a;return this.a=e*r-i*this.b,this.b=i*r+e*this.b,r=this.c,this.c=e*r-i*this.d,this.d=i*r+e*this.d,this},Matrix2D.prototype.preScale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this},Matrix2D.prototype.preTranslate=function(t,e){return"number"==typeof t?(this.e+=t,this.f+=e):(this.e+=t.x,this.f+=t.y),this},Matrix2D.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a;return this.a=e*r-i*this.b,this.b=i*r+e*this.b,r=this.c,this.c=e*r-i*this.d,this.d=i*r+e*this.d,r=this.e,this.e=e*r-i*this.f,this.f=i*r+e*this.f,this},Matrix2D.prototype.scale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this},Matrix2D.prototype.setValues=function(t,e,i,r,n,s){return t instanceof Matrix2D?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f):(this.a=t,this.b=e,this.c=i,this.d=r,this.e=n,this.f=s),this},Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},Matrix2D.prototype.translate=function(t,e){return"number"==typeof t?(this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e):(this.e+=this.a*t.x+this.c*t.y,this.f+=this.b*t.x+this.d*t.y),this},Matrix2D),Crafty.c("Delay",{init:function(){this._delays=[],this.bind("EnterFrame",function(){for(var t=(new Date).getTime(),e=this._delays.length;--e>=0;){var i=this._delays[e];i.start+i.delay+i.pause<t&&(i.func.call(this),i.repeat>0?(i.start=t,i.pause=0,i.pauseBuffer=0,i.repeat--):i.repeat<=0&&this._delays.splice(e,1))}}),this.bind("Pause",function(){var t=(new Date).getTime();for(var e in this._delays)this._delays[e].pauseBuffer=t}),this.bind("Unpause",function(){var t=(new Date).getTime();for(var e in this._delays){var i=this._delays[e];i.pause+=t-i.pauseBuffer}})},delay:function(t,e,i){return this._delays.push({start:(new Date).getTime(),func:t,delay:e,repeat:(i<0?1/0:i)||0,pauseBuffer:0,pause:0}),this}})})},function(t,e){window.board=Array(),Game={map_grid:{width:24,height:16,tile:{width:16,height:16}},width:function(){return this.map_grid.width*this.map_grid.tile.width},height:function(){return this.map_grid.height*this.map_grid.tile.height},over:function(){if(!this.boardChanged)return!0;for(var t=0;t<Game.map_grid.width;t++)for(var e=0;e<Game.map_grid.height;e++)if(board[t][e].attr("state"))return!1;return!0},start:function(){Crafty.init(Game.width(),Game.height()),Crafty.background("rgb(249, 223, 125)"),board=new Array(Game.map_grid.width);for(var t=0;t<Game.map_grid.width;t++){board[t]=new Array(Game.map_grid.height);for(var e=0;e<Game.map_grid.height;e++)board[t][e]=!1}i=0,e=0;for(var i=0;i<Game.map_grid.width;i++)for(e=0;e<Game.map_grid.height;e++)e<Game.map_grid.height&&i<Game.map_grid.width&&(board[i][e]=Crafty.e("Cell").at(i,e));i=0,e=0;for(i=0;i<Game.map_grid.width;i++)for(e=0;e<Game.map_grid.height;e++)board[i][e].findNeighbors();this.intervalID=window.setInterval(Game.turn,1e3)},turn:function(){if(Game.over())clearInterval(this.intervalID),Crafty.pause(),alert("Game Over!");else{this.boardChanged=!1;for(var t=0;t<Game.map_grid.width;t++)for(var e=0;e<Game.map_grid.height;e++)board[t][e].calculateState();for(t=0;t<Game.map_grid.width;t++)for(e=0;e<Game.map_grid.height;e++)board[t][e].updateState()}},boardChanged:!0},window.addEventListener("load",Game.start)},function(t,e){Crafty.c("Grid",{init:function(){this.attr({w:Game.map_grid.tile.width,h:Game.map_grid.tile.height})},at:function(t,e){return void 0===t&&void 0===e?{x:this.x/Game.map_grid.tile.width,y:this.y/Game.map_grid.tile.height}:(this.attr({x:t*Game.map_grid.tile.width,y:e*Game.map_grid.tile.height}),this)}}),Crafty.c("Actor",{init:function(){this.requires("2D, Canvas, Grid")}}),randomSpawnStratagy=function(t,e){return function(){return Math.floor(Math.random()*(e-t+1)+t)===t}},Crafty.c("Cell",{init:function(){this.requires("Actor, Color"),this.attr({state:!1,nextState:void 0,neighbors:Array()}),this.attr("state",this.spawn()),this.attr("state")?this.color("rgb(20, 125, 40)"):this.color("rgb(249, 223, 125)")},spawn:randomSpawnStratagy(2,8),findNeighbors:function(){var t,e,i,r;return e=(t=this.at()).x,i=t.y,r=Array(),e+1<Game.map_grid.width&&(r[r.length]=board[e+1][i]),e-1>=0&&(r[r.length]=board[e-1][i]),i+1<Game.map_grid.height&&(r[r.length]=board[e][i+1]),i-1>=0&&(r[r.length]=board[e][i-1]),e-1>=0&&i-1>=0&&(r[r.length]=board[e-1][i-1]),e+1<Game.map_grid.width&&i-1>=0&&(r[r.length]=board[e+1][i-1]),e-1>=0&&i+1<Game.map_grid.height&&(r[r.length]=board[e-1][i+1]),e+1<Game.map_grid.width&&i+1<Game.map_grid.height&&(r[r.length]=board[e+1][i+1]),this.attr("neighbors",r),r},sumNeighbors:function(){var t,e=0;for(t=this.attr("neighbors"),i=0;i<t.length;i++)t[i].attr("state")&&e++;return e},deadStrategy:function(){return 3===this.sumNeighbors()},liveStrategy:function(){var t=this.sumNeighbors();return 2===t||3===t},calculateState:function(){this.attr("state")?this.attr("nextState",this.liveStrategy()):this.attr("nextState",this.deadStrategy())},updateState:function(){this.attr("state")!==this.attr("nextState")&&(Game.boardChanged=!0),this.attr("state",this.attr("nextState")),this.attr("state")?this.color("rgb(20, 125, 40)"):this.color("rgb(249, 223, 125)")}})}]);